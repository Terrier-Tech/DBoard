var lt=Object.defineProperty,ct=Object.defineProperties;var ht=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var pt=Object.prototype.hasOwnProperty,ut=Object.prototype.propertyIsEnumerable;var j=(n,t,e)=>t in n?lt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,p=(n,t)=>{for(var e in t||(t={}))pt.call(t,e)&&j(n,e,t[e]);if(U)for(var e of U(t))ut.call(t,e)&&j(n,e,t[e]);return n},w=(n,t)=>ct(n,ht(t));import{r as i,a as dt}from"./vendor.b71a34ef.js";const mt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}};mt();class xt{constructor(){this.fontSize=14,this.lineHeight=32,this.padding=12,this.iconSize=48,this.minEntitySize=8*this.gridSize,this.planeSize=3e3,this.borderSize=2,this.entityRadius=6,this.attributeRadius=this.entityRadius-this.borderSize,this.dashSize=this.lineHeight/5*1.414,this.fontFamily="Verdana, Geneva, sans-serif",this.colors={blue:"#2980b9",green:"#27ae60",purple:"#8e44ad",cyan:"#079992",gray:"#bdc3c7",orange:"#f39c12",red:"#c0392b",yellow:"#f1c40f"},this.primaryColor="#7e7367",this.fgColor="#362b21",this.oddBgColor="transparent",this.evenBgColor="#f6f2f0",this.hintFgColor="#d9d0c7",this.hintBgColor="#f2e9df",this.utilCanvas=document.createElement("canvas"),this.utilContext=this.utilCanvas.getContext("2d")}get gridSize(){return this.lineHeight/2}measureText(t,e="normal"){return this.utilContext.font=`${e} ${this.fontSize}px sans-serif`,this.utilContext.measureText(t)}snapNearest(t){return Math.round(t/this.gridSize)*this.gridSize}snapUp(t){return Math.ceil(t/this.gridSize)*this.gridSize}snapUpEven(t){return Math.ceil(t/(2*this.gridSize))*this.gridSize*2}color(t){return this.colors[t]}}const _=n=>i.exports.createElement("svg",p({width:"160px",height:"48px",viewBox:"0 0 160 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"logo-white"),i.exports.createElement("g",{id:"logo-white",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("g",{id:"board",transform:"translate(12.000000, 8.000000)",fill:"#FFFFFF"},i.exports.createElement("path",{d:"M30,4 C31.1045695,4 32,4.8954305 32,6 L32,22 C32,23.1045695 31.1045695,24 30,24 L2,24 C0.8954305,24 1.3527075e-16,23.1045695 0,22 L0,6 C-1.3527075e-16,4.8954305 0.8954305,4 2,4 L30,4 Z M29,9 L3,9 C2.44771525,9 2,9.44771525 2,10 L2,10 L2,21 C2,21.5522847 2.44771525,22 3,22 L3,22 L29,22 C29.5522847,22 30,21.5522847 30,21 L30,21 L30,10 C30,9.44771525 29.5522847,9 29,9 L29,9 Z",id:"Rectangle-2"}),i.exports.createElement("path",{d:"M16,0 C16.5522847,-1.01453063e-16 17,0.44771525 17,1 L17,4 L17,4 L15,4 L15,1 C15,0.44771525 15.4477153,1.01453063e-16 16,0 Z",id:"Rectangle"}),i.exports.createElement("path",{d:"M15,24 L17,24 L17,31 C17,31.5522847 16.5522847,32 16,32 C15.4477153,32 15,31.5522847 15,31 L15,24 L15,24 Z",id:"Rectangle-Copy-2"}),i.exports.createElement("path",{d:"M14,24 L7.06066017,30.9393398 C6.81801948,31.1819805 6.81801948,31.5753788 7.06066017,31.8180195 C7.17718034,31.9345397 7.3352156,32 7.5,32 L8.58578644,32 C8.85100293,32 9.10535684,31.8946432 9.29289322,31.7071068 L15,26 L15,26 L15,24 L14,24 Z",id:"Path-2"}),i.exports.createElement("path",{d:"M24,24 L17.9877569,30.871135 C17.7402159,31.154039 17.7688833,31.5840497 18.0517873,31.8315907 C18.1758644,31.9401582 18.3351302,32 18.5,32 L19.5316251,32 C19.8284049,32 20.1098525,31.868177 20.2998463,31.6401844 L25,26 L25,26 L25,24 L24,24 Z",id:"Path-2-Copy",transform:"translate(21.000000, 28.000000) scale(-1, 1) translate(-21.000000, -28.000000) "})),i.exports.createElement("g",{id:"quicksand",transform:"translate(56.818000, 12.760000)",fill:"#FFFFFF",fillRule:"nonzero"},i.exports.createElement("path",{d:"M7.8,1.04 C9.048,1.04 10.1573333,1.274 11.128,1.742 C12.0986667,2.21 12.9176667,2.86433333 13.585,3.705 C14.2523333,4.54566667 14.755,5.51633333 15.093,6.617 C15.431,7.71766667 15.6,8.892 15.6,10.14 C15.6,11.8213333 15.2966667,13.351 14.69,14.729 C14.0833333,16.107 13.2036667,17.2033333 12.051,18.018 C10.8983333,18.8326667 9.48133333,19.24 7.8,19.24 L1.586,19.24 C1.13533333,19.24 0.758333333,19.0883333 0.455,18.785 C0.151666667,18.4816667 7.10542736e-15,18.1046667 7.10542736e-15,17.654 L7.10542736e-15,2.626 C7.10542736e-15,2.17533333 0.151666667,1.79833333 0.455,1.495 C0.758333333,1.19166667 1.13533333,1.04 1.586,1.04 L7.8,1.04 Z M7.54,16.25 C8.632,16.25 9.52466667,15.9683333 10.218,15.405 C10.9113333,14.8416667 11.4183333,14.0963333 11.739,13.169 C12.0596667,12.2416667 12.22,11.232 12.22,10.14 C12.22,9.32533333 12.129,8.54966667 11.947,7.813 C11.765,7.07633333 11.4833333,6.42633333 11.102,5.863 C10.7206667,5.29966667 10.2353333,4.85333333 9.646,4.524 C9.05666667,4.19466667 8.35466667,4.03 7.54,4.03 L2.99,4.03 L3.25,3.796 L3.25,16.536 L3.094,16.25 L7.54,16.25 Z",id:"Shape"}),i.exports.createElement("path",{d:"M26.728,1.04 C28.392,1.04 29.6313333,1.43 30.446,2.21 C31.2606667,2.99 31.668,4.14266667 31.668,5.668 C31.668,6.48266667 31.4686667,7.19766667 31.07,7.813 C30.6713333,8.42833333 30.082,8.905 29.302,9.243 C28.522,9.581 27.56,9.75 26.416,9.75 L26.52,8.58 C27.0573333,8.58 27.6726667,8.65366667 28.366,8.801 C29.0593333,8.94833333 29.731,9.20833333 30.381,9.581 C31.031,9.95366667 31.5683333,10.4736667 31.993,11.141 C32.4176667,11.8083333 32.63,12.662 32.63,13.702 C32.63,14.846 32.4436667,15.782 32.071,16.51 C31.6983333,17.238 31.2086667,17.8013333 30.602,18.2 C29.9953333,18.5986667 29.3453333,18.8716667 28.652,19.019 C27.9586667,19.1663333 27.2913333,19.24 26.65,19.24 L20.176,19.24 C19.7253333,19.24 19.3483333,19.0883333 19.045,18.785 C18.7416667,18.4816667 18.59,18.1046667 18.59,17.654 L18.59,2.626 C18.59,2.17533333 18.7416667,1.79833333 19.045,1.495 C19.3483333,1.19166667 19.7253333,1.04 20.176,1.04 L26.728,1.04 Z M26.26,4.108 L21.632,4.108 L21.97,3.692 L21.97,8.398 L21.658,8.164 L26.338,8.164 C26.8406667,8.164 27.2913333,7.99933333 27.69,7.67 C28.0886667,7.34066667 28.288,6.864 28.288,6.24 C28.288,5.49466667 28.1016667,4.953 27.729,4.615 C27.3563333,4.277 26.8666667,4.108 26.26,4.108 Z M26.468,11.232 L21.736,11.232 L21.97,11.024 L21.97,16.51 L21.71,16.25 L26.65,16.25 C27.4473333,16.25 28.08,16.0376667 28.548,15.613 C29.016,15.1883333 29.25,14.5513333 29.25,13.702 C29.25,12.922 29.094,12.3586667 28.782,12.012 C28.47,11.6653333 28.0973333,11.4486667 27.664,11.362 C27.2306667,11.2753333 26.832,11.232 26.468,11.232 Z",id:"Shape"}),i.exports.createElement("path",{d:"M48.724,12.298 C48.724,13.7193333 48.4076667,14.9716667 47.775,16.055 C47.1423333,17.1383333 46.293,17.9833333 45.227,18.59 C44.161,19.1966667 42.9693333,19.5 41.652,19.5 C40.3346667,19.5 39.143,19.1966667 38.077,18.59 C37.011,17.9833333 36.1616667,17.1383333 35.529,16.055 C34.8963333,14.9716667 34.58,13.7193333 34.58,12.298 C34.58,10.8766667 34.8963333,9.62433333 35.529,8.541 C36.1616667,7.45766667 37.011,6.60833333 38.077,5.993 C39.143,5.37766667 40.3346667,5.07 41.652,5.07 C42.9693333,5.07 44.161,5.37766667 45.227,5.993 C46.293,6.60833333 47.1423333,7.45766667 47.775,8.541 C48.4076667,9.62433333 48.724,10.8766667 48.724,12.298 Z M45.604,12.298 C45.604,11.414 45.4263333,10.647 45.071,9.997 C44.7156667,9.347 44.239,8.84 43.641,8.476 C43.043,8.112 42.38,7.93 41.652,7.93 C40.924,7.93 40.261,8.112 39.663,8.476 C39.065,8.84 38.5883333,9.347 38.233,9.997 C37.8776667,10.647 37.7,11.414 37.7,12.298 C37.7,13.1646667 37.8776667,13.923 38.233,14.573 C38.5883333,15.223 39.065,15.73 39.663,16.094 C40.261,16.458 40.924,16.64 41.652,16.64 C42.38,16.64 43.043,16.458 43.641,16.094 C44.239,15.73 44.7156667,15.223 45.071,14.573 C45.4263333,13.923 45.604,13.1646667 45.604,12.298 Z",id:"Shape"}),i.exports.createElement("path",{d:"M62.582,5.07 C63.0326667,5.07 63.4053333,5.21733333 63.7,5.512 C63.9946667,5.80666667 64.142,6.188 64.142,6.656 L64.142,17.654 C64.142,18.1046667 63.9946667,18.4816667 63.7,18.785 C63.4053333,19.0883333 63.0326667,19.24 62.582,19.24 C62.1313333,19.24 61.7586667,19.0883333 61.464,18.785 C61.1693333,18.4816667 61.022,18.1046667 61.022,17.654 L61.022,16.38 L61.594,16.614 C61.594,16.8393333 61.4726667,17.1123333 61.23,17.433 C60.9873333,17.7536667 60.658,18.07 60.242,18.382 C59.826,18.694 59.3363333,18.9583333 58.773,19.175 C58.2096667,19.3916667 57.5986667,19.5 56.94,19.5 C55.744,19.5 54.6606667,19.1923333 53.69,18.577 C52.7193333,17.9616667 51.9523333,17.1123333 51.389,16.029 C50.8256667,14.9456667 50.544,13.702 50.544,12.298 C50.544,10.8766667 50.8256667,9.62433333 51.389,8.541 C51.9523333,7.45766667 52.7106667,6.60833333 53.664,5.993 C54.6173333,5.37766667 55.6746667,5.07 56.836,5.07 C57.5813333,5.07 58.266,5.18266667 58.89,5.408 C59.514,5.63333333 60.0556667,5.91933333 60.515,6.266 C60.9743333,6.61266667 61.3296667,6.96366667 61.581,7.319 C61.8323333,7.67433333 61.958,7.97333333 61.958,8.216 L61.022,8.554 L61.022,6.656 C61.022,6.20533333 61.1693333,5.82833333 61.464,5.525 C61.7586667,5.22166667 62.1313333,5.07 62.582,5.07 Z M57.33,16.64 C58.0926667,16.64 58.76,16.4493333 59.332,16.068 C59.904,15.6866667 60.3503333,15.1666667 60.671,14.508 C60.9916667,13.8493333 61.152,13.1126667 61.152,12.298 C61.152,11.466 60.9916667,10.7206667 60.671,10.062 C60.3503333,9.40333333 59.904,8.88333333 59.332,8.502 C58.76,8.12066667 58.0926667,7.93 57.33,7.93 C56.5846667,7.93 55.926,8.12066667 55.354,8.502 C54.782,8.88333333 54.3356667,9.40333333 54.015,10.062 C53.6943333,10.7206667 53.534,11.466 53.534,12.298 C53.534,13.1126667 53.6943333,13.8493333 54.015,14.508 C54.3356667,15.1666667 54.782,15.6866667 55.354,16.068 C55.926,16.4493333 56.5846667,16.64 57.33,16.64 Z",id:"Shape"}),i.exports.createElement("path",{d:"M69.082,19.24 C68.6313333,19.24 68.2586667,19.0883333 67.964,18.785 C67.6693333,18.4816667 67.522,18.1046667 67.522,17.654 L67.522,6.916 C67.522,6.46533333 67.6693333,6.08833333 67.964,5.785 C68.2586667,5.48166667 68.6313333,5.33 69.082,5.33 C69.5326667,5.33 69.9053333,5.48166667 70.2,5.785 C70.4946667,6.08833333 70.642,6.46533333 70.642,6.916 L70.642,9.36 L70.46,7.618 C70.6506667,7.202 70.8976667,6.83366667 71.201,6.513 C71.5043333,6.19233333 71.8466667,5.92366667 72.228,5.707 C72.6093333,5.49033333 73.0166667,5.33 73.45,5.226 C73.8833333,5.122 74.3166667,5.07 74.75,5.07 C75.27,5.07 75.7076667,5.21733333 76.063,5.512 C76.4183333,5.80666667 76.596,6.15333333 76.596,6.552 C76.596,7.124 76.4486667,7.53566667 76.154,7.787 C75.8593333,8.03833333 75.5386667,8.164 75.192,8.164 C74.8626667,8.164 74.5636667,8.10333333 74.295,7.982 C74.0263333,7.86066667 73.7186667,7.8 73.372,7.8 C73.06,7.8 72.7436667,7.87366667 72.423,8.021 C72.1023333,8.16833333 71.8076667,8.398 71.539,8.71 C71.2703333,9.022 71.0536667,9.40766667 70.889,9.867 C70.7243333,10.3263333 70.642,10.868 70.642,11.492 L70.642,17.654 C70.642,18.1046667 70.4946667,18.4816667 70.2,18.785 C69.9053333,19.0883333 69.5326667,19.24 69.082,19.24 Z",id:"Path"}),i.exports.createElement("path",{d:"M90.064,0 C90.5146667,0 90.8873333,0.147333333 91.182,0.442 C91.4766667,0.736666667 91.624,1.118 91.624,1.586 L91.624,17.654 C91.624,18.1046667 91.4766667,18.4816667 91.182,18.785 C90.8873333,19.0883333 90.5146667,19.24 90.064,19.24 C89.6133333,19.24 89.2406667,19.0883333 88.946,18.785 C88.6513333,18.4816667 88.504,18.1046667 88.504,17.654 L88.504,16.38 L89.076,16.614 C89.076,16.8393333 88.9546667,17.1123333 88.712,17.433 C88.4693333,17.7536667 88.14,18.07 87.724,18.382 C87.308,18.694 86.8183333,18.9583333 86.255,19.175 C85.6916667,19.3916667 85.0806667,19.5 84.422,19.5 C83.226,19.5 82.1426667,19.1923333 81.172,18.577 C80.2013333,17.9616667 79.4343333,17.1123333 78.871,16.029 C78.3076667,14.9456667 78.026,13.702 78.026,12.298 C78.026,10.8766667 78.3076667,9.62433333 78.871,8.541 C79.4343333,7.45766667 80.1926667,6.60833333 81.146,5.993 C82.0993333,5.37766667 83.1566667,5.07 84.318,5.07 C85.0633333,5.07 85.748,5.18266667 86.372,5.408 C86.996,5.63333333 87.5376667,5.91933333 87.997,6.266 C88.4563333,6.61266667 88.8116667,6.96366667 89.063,7.319 C89.3143333,7.67433333 89.44,7.97333333 89.44,8.216 L88.504,8.554 L88.504,1.586 C88.504,1.13533333 88.6513333,0.758333333 88.946,0.455 C89.2406667,0.151666667 89.6133333,0 90.064,0 Z M84.812,16.64 C85.5746667,16.64 86.242,16.4493333 86.814,16.068 C87.386,15.6866667 87.8323333,15.1666667 88.153,14.508 C88.4736667,13.8493333 88.634,13.1126667 88.634,12.298 C88.634,11.466 88.4736667,10.7206667 88.153,10.062 C87.8323333,9.40333333 87.386,8.88333333 86.814,8.502 C86.242,8.12066667 85.5746667,7.93 84.812,7.93 C84.0666667,7.93 83.408,8.12066667 82.836,8.502 C82.264,8.88333333 81.8176667,9.40333333 81.497,10.062 C81.1763333,10.7206667 81.016,11.466 81.016,12.298 C81.016,13.1126667 81.1763333,13.8493333 81.497,14.508 C81.8176667,15.1666667 82.264,15.6866667 82.836,16.068 C83.408,16.4493333 84.0666667,16.64 84.812,16.64 Z",id:"Shape"})))),yt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-blank-document"),i.exports.createElement("g",{id:"icon-blank-document",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("g",{id:"stroke-copy",transform:"translate(12.000000, 8.000000)",fill:"#FFFFFF",fillRule:"nonzero"},i.exports.createElement("path",{d:"M16.5857864,0.585786438 L23.4142136,7.41421356 C23.7892863,7.78928632 24,8.29799415 24,8.82842712 L24,30 C24,31.1045695 23.1045695,32 22,32 L2,32 C0.8954305,32 -5.30863065e-16,31.1045695 0,30 L0,2 C-1.3527075e-16,0.8954305 0.8954305,2.02906125e-16 2,0 L15.1715729,0 C15.7020059,-1.8737958e-15 16.2107137,0.210713681 16.5857864,0.585786438 Z M14.7567864,2 L3,2 C2.44771525,2 2,2.44771525 2,3 L2,29 C2,29.5522847 2.44771525,30 3,30 L21,30 C21.5522847,30 22,29.5522847 22,29 L22,9.24321356 C22,8.97799707 21.8946432,8.72364316 21.7071068,8.53610678 L15.4638932,2.29289322 C15.2763568,2.10535684 15.0220029,2 14.7567864,2 Z",id:"Path-12"}),i.exports.createElement("path",{d:"M16,1 L16,7 C16,7.55228475 16.4477153,8 17,8 L23,8 L23,8 L23,10 L15,10 C14.4477153,10 14,9.55228475 14,9 L14,1 L14,1 L16,1 Z",id:"Path-13"})))),ft=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-close"),i.exports.createElement("g",{id:"icon-close",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("rect",{id:"Rectangle",fill:"#FFFFFF",transform:"translate(24.500000, 24.000000) rotate(45.000000) translate(-24.500000, -24.000000) ",x:8,y:22,width:33,height:4,rx:2}),i.exports.createElement("rect",{id:"Rectangle-Copy",fill:"#FFFFFF",transform:"translate(24.000000, 24.000000) rotate(45.000000) translate(-24.000000, -24.000000) ",x:22,y:8,width:4,height:32,rx:2}))),gt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-delete"),i.exports.createElement("g",{id:"icon-delete",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("path",{d:"M10,15 L10,14 C10,12.8954305 10.8954305,12 12,12 L36,12 C37.1045695,12 38,12.8954305 38,14 L38,15 L38,15 L10,15 Z",id:"Path-3",fill:"#FFFFFF"}),i.exports.createElement("path",{d:"M36,15 L34.1420467,39.153393 C34.0618933,40.1953873 33.1930103,41 32.1479377,41 L32.1479377,41 L15.8520623,41 C14.8069897,41 13.9381067,40.1953873 13.8579533,39.153393 L13.8579533,39.153393 L12,15 L36,15 Z M25,17 L23,17 C22.4477153,17 22,17.4477153 22,18 L22,38 C22,38.5522847 22.4477153,39 23,39 L25,39 C25.5522847,39 26,38.5522847 26,38 L26,18 C26,17.4477153 25.5522847,17 25,17 Z M32.9049672,17 L30.955578,17 C30.4209498,17 29.9808857,17.4205156 29.9566094,17.9545923 L29.0475185,37.9545923 C29.0224406,38.5063074 29.4493643,38.9738906 30.0010794,38.9989685 C30.0162055,38.9996561 30.0313453,39 30.0464871,39 L31.0867854,39 C31.6039886,39 32.0358532,38.6056149 32.0826786,38.0905357 L33.9008604,18.0905357 C33.9508619,17.5405191 33.5455196,17.0541083 32.9955029,17.0041068 C32.9654019,17.0013703 32.9351923,17 32.9049672,17 Z M17.044422,17 L15.0950328,17 C14.5427481,17 14.0950328,17.4477153 14.0950328,18 C14.0950328,18.0302251 14.0964032,18.0604347 14.0991396,18.0905357 L15.9173214,38.0905357 C15.9641468,38.6056149 16.3960114,39 16.9132146,39 L17.9535129,39 C18.5057977,39 18.9535129,38.5522847 18.9535129,38 C18.9535129,37.9848583 18.953169,37.9697185 18.9524815,37.9545923 L18.0433906,17.9545923 C18.0191143,17.4205156 17.5790502,17 17.044422,17 Z",id:"Path-6",fill:"#FFFFFF"}),i.exports.createElement("path",{d:"M26,9 C27.6568542,9 29,10.3431458 29,12 C29,13.6568542 27.6568542,15 26,15 L22,15 C20.3431458,15 19,13.6568542 19,12 C19,10.3431458 20.3431458,9 22,9 L26,9 Z M26,11 L22,11 C21.4477153,11 21,11.4477153 21,12 L21,12 L21,13 C21,13.5522847 21.4477153,14 22,14 L22,14 L26,14 C26.5522847,14 27,13.5522847 27,13 L27,13 L27,12 C27,11.4477153 26.5522847,11 26,11 L26,11 Z",id:"Rectangle-2",fill:"#FFFFFF"}))),Ct=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-download"),i.exports.createElement("g",{id:"icon-download",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("path",{d:"M23.375305,29.500244 L16.226086,23.7808688 C15.7948241,23.4358593 15.7249027,22.8065669 16.0699122,22.375305 C16.2596844,22.1380897 16.5469973,22 16.8507811,22 L20,22 C20.5522847,22 21,21.5522847 21,21 L21,13 C21,12.4477153 21.4477153,12 22,12 L26,12 C26.5522847,12 27,12.4477153 27,13 L27,21 C27,21.5522847 27.4477153,22 28,22 L31.1492189,22 C31.7015037,22 32.1492189,22.4477153 32.1492189,23 C32.1492189,23.3037837 32.0111292,23.5910966 31.773914,23.7808688 L24.624695,29.500244 C24.2594764,29.7924189 23.7405236,29.7924189 23.375305,29.500244 Z",id:"Path-10",fill:"#FFFFFF"}),i.exports.createElement("path",{d:"M10,29 L10,35 C10,35.5522847 10.4477153,36 11,36 L37,36 C37.5522847,36 38,35.5522847 38,35 L38,29 C38,28.4477153 37.5522847,28 37,28 L35,28 C34.4477153,28 34,28.4477153 34,29 L34,31.2077207 C34,31.7600054 33.5522847,32.2077207 33,32.2077207 L15,32.2077207 C14.4477153,32.2077207 14,31.7600054 14,31.2077207 L14,29 C14,28.4477153 13.5522847,28 13,28 L11,28 C10.4477153,28 10,28.4477153 10,29 Z",id:"Path-9",fill:"#FFFFFF"}))),wt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-github"),i.exports.createElement("g",{id:"icon-github",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("path",{d:"M24,8 C32.836556,8 40,15.163444 40,24 C40,31.2946359 35.1183904,37.4491109 28.4437619,39.374834 C28.1343281,39.141899 27.9342384,38.8247689 27.9342384,38.4349788 L27.9342384,32.3428882 L27.9342384,32.3428882 L27.5025506,31.165503 C30.9142123,30.3979495 33.2136782,28.8632404 34.4009483,26.5613755 C36.1818534,23.1085783 34.6312024,18.8807796 33.190018,18.1280103 C33.7573762,16.0771787 33.6214349,14.3678419 32.7821942,13 C30.8976086,13 29.2816233,13.683921 27.9342384,15.0517629 C25.0076038,14.0098453 23.0155743,14.0098453 19.8499292,15.0517629 C18.5697955,13.683921 16.9826744,13 15.0885658,13 C14.3756295,14.3678419 14.2683267,16.0771787 14.7666574,18.1280103 C13.3439356,19.5837799 12.2116421,23.4581301 13.5842147,26.6985617 C14.4992631,28.8588494 16.8403346,30.3478298 20.6074292,31.165503 L20.2664011,33.4200611 C19.0679546,33.6591944 17.9730244,33.5691471 16.9816106,33.1499192 C15.4944898,32.5210773 14.8133808,30.7120647 13.792427,30.4154397 C13.1117911,30.2176898 12.5143155,30.2176898 12,30.4154397 C12.8997769,31.3378462 13.4972525,31.980329 13.792427,32.3428882 C14.2351888,32.8867271 14.7257577,34.8172735 16.4884849,35.5769272 C17.6636364,36.083363 18.9229418,36.2243873 20.2664011,36 L20.2664011,38.4349788 C20.196369,38.8665434 20.0397455,39.2023402 19.7965307,39.4423691 C12.9985755,37.5955407 8,31.3815103 8,24 C8,15.163444 15.163444,8 24,8 Z",id:"Oval-2",fill:"#FFFFFF"}))),Et=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-open"),i.exports.createElement("g",{id:"icon-open",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd",strokeLinejoin:"round"},i.exports.createElement("path",{d:"M33,18 L33,16 C33,15.4477153 32.5522847,15 32,15 L19.4142136,15 C19.1489971,15 18.8946432,14.8946432 18.7071068,14.7071068 L17.2928932,13.2928932 C17.1053568,13.1053568 16.8510029,13 16.5857864,13 L11.4142136,13 C11.1489971,13 10.8946432,13.1053568 10.7071068,13.2928932 L9.29289322,14.7071068 C9.10535684,14.8946432 9,15.1489971 9,15.4142136 L9,35 L9,35 L31.6606146,35 C32.4710623,35 33.2013929,34.5109029 33.5099707,33.7614996 L39.431456,19.3807498 C39.6417383,18.8700642 39.3982133,18.2856042 38.8875277,18.0753219 C38.7667483,18.0255892 38.6373957,18 38.5067779,18 L18.2692111,18 C17.494487,18 16.7894489,18.4474211 16.4595737,19.1484059 L9,35 L9,35",id:"Path-11",stroke:"#FFFFFF",strokeWidth:2}))),bt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-plus-entity"),i.exports.createElement("g",{id:"icon-plus-entity",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("path",{d:"M37,8 C38.6568542,8 40,9.34314575 40,11 L40,35 C40,36.6568542 38.6568542,38 37,38 L11,38 C9.34314575,38 8,36.6568542 8,35 L8,11 C8,9.34314575 9.34314575,8 11,8 L37,8 Z M36,16 L12,16 C10.8954305,16 10,16.8954305 10,18 L10,18 L10,34 C10,35.1045695 10.8954305,36 12,36 L12,36 L36,36 C37.1045695,36 38,35.1045695 38,34 L38,34 L38,18 C38,16.8954305 37.1045695,16 36,16 L36,16 Z",id:"Rectangle-2",fill:"#FFFFFF"}),i.exports.createElement("g",{id:"plus",transform:"translate(18.000000, 20.000000)",fill:"#FFFFFF"},i.exports.createElement("rect",{id:"Rectangle",x:5,y:0,width:2,height:12,rx:1}),i.exports.createElement("rect",{id:"Rectangle-Copy-2",x:0,y:5,width:12,height:2,rx:1})))),vt=n=>i.exports.createElement("svg",p({width:"48px",height:"32px",viewBox:"0 0 48 32",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-plus-attribute"),i.exports.createElement("g",{id:"icon-plus-attribute",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("g",{id:"plus",transform:"translate(2.000000, 10.000000)",fill:"#FFFFFF"},i.exports.createElement("rect",{id:"Rectangle",x:5,y:0,width:2,height:12,rx:1}),i.exports.createElement("rect",{id:"Rectangle-Copy-2",x:0,y:5,width:12,height:2,rx:1})),i.exports.createElement("rect",{id:"Rectangle",fill:"#FFFFFF",x:16,y:8,width:24,height:2,rx:1}),i.exports.createElement("rect",{id:"Rectangle-Copy",fill:"#FFFFFF",x:20,y:15,width:24,height:2,rx:1}),i.exports.createElement("rect",{id:"Rectangle-Copy-3",fill:"#FFFFFF",x:16,y:22,width:24,height:2,rx:1}))),Lt=n=>i.exports.createElement("svg",p({width:"48px",height:"32px",viewBox:"0 0 48 32",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-plus-association"),i.exports.createElement("g",{id:"icon-plus-association",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("rect",{id:"Rectangle-Copy",fill:"#FFFFFF",x:18,y:15,width:26,height:2,rx:1}),i.exports.createElement("path",{d:"M33,15 L42.9454237,5.05457633 C43.1866726,4.8133274 43.5778144,4.8133274 43.8190633,5.05457633 C43.9349151,5.17042814 44,5.32755693 44,5.49139614 L44,6.56920791 C44,6.83405214 43.8949379,7.08808038 43.707866,7.27555462 L36,15 L36,15 L33,15 Z",id:"Path-7",fill:"#FFFFFF"}),i.exports.createElement("path",{d:"M33,28 L42.9606506,18.0393494 C43.1984161,17.8015839 43.5839103,17.8015839 43.8216758,18.0393494 C43.9358549,18.1535285 44,18.3083885 44,18.469862 L44,19.5290943 C44,19.7921888 43.8963178,20.0446844 43.711425,20.2318563 L36.0378746,28 L36.0378746,28 L33,28 Z",id:"Path-7-Copy",fill:"#FFFFFF",transform:"translate(38.500000, 22.500000) scale(1, -1) translate(-38.500000, -22.500000) "}),i.exports.createElement("g",{id:"plus",transform:"translate(2.000000, 10.000000)",fill:"#FFFFFF"},i.exports.createElement("rect",{id:"Rectangle",x:5,y:0,width:2,height:12,rx:1}),i.exports.createElement("rect",{id:"Rectangle-Copy-2",x:0,y:5,width:12,height:2,rx:1})))),Ft=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-undo"),i.exports.createElement("g",{id:"icon-undo",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("polygon",{id:"Path-5",fill:"#FFFFFF",points:"13 21 13 13 21 21"}),i.exports.createElement("path",{d:"M24,12 C30.627417,12 36,17.372583 36,24 C36,30.627417 30.627417,36 24,36 C22.8954305,36 22,35.1045695 22,34 C22,32.8954305 22.8954305,32 24,32 C28.418278,32 32,28.418278 32,24 C32,19.581722 28.418278,16 24,16 C19.581722,16 16,19.581722 16,24 C16,25.1045695 15.1045695,26 14,26 C12.8954305,26 12,25.1045695 12,24 C12,17.372583 17.372583,12 24,12 Z",id:"Oval",fill:"#FFFFFF",fillRule:"nonzero",transform:"translate(24.000000, 24.000000) rotate(45.000000) translate(-24.000000, -24.000000) "}))),St=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-upload"),i.exports.createElement("g",{id:"icon-upload",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("path",{d:"M23.375305,29.500244 L16.226086,23.7808688 C15.7948241,23.4358593 15.7249027,22.8065669 16.0699122,22.375305 C16.2596844,22.1380897 16.5469973,22 16.8507811,22 L20,22 C20.5522847,22 21,21.5522847 21,21 L21,13 C21,12.4477153 21.4477153,12 22,12 L26,12 C26.5522847,12 27,12.4477153 27,13 L27,21 C27,21.5522847 27.4477153,22 28,22 L31.1492189,22 C31.7015037,22 32.1492189,22.4477153 32.1492189,23 C32.1492189,23.3037837 32.0111292,23.5910966 31.773914,23.7808688 L24.624695,29.500244 C24.2594764,29.7924189 23.7405236,29.7924189 23.375305,29.500244 Z",id:"Path-10",fill:"#FFFFFF",transform:"translate(24.000000, 21.000000) scale(1, -1) translate(-24.000000, -21.000000) "}),i.exports.createElement("path",{d:"M10,29 L10,35 C10,35.5522847 10.4477153,36 11,36 L37,36 C37.5522847,36 38,35.5522847 38,35 L38,29 C38,28.4477153 37.5522847,28 37,28 L35,28 C34.4477153,28 34,28.4477153 34,29 L34,31.2077207 C34,31.7600054 33.5522847,32.2077207 33,32.2077207 L15,32.2077207 C14.4477153,32.2077207 14,31.7600054 14,31.2077207 L14,29 C14,28.4477153 13.5522847,28 13,28 L11,28 C10.4477153,28 10,28.4477153 10,29 Z",id:"Path-9",fill:"#FFFFFF"}))),kt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-redo"),i.exports.createElement("g",{id:"icon-redo",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("polygon",{id:"Path-5",fill:"#FFFFFF",transform:"translate(31.000000, 17.000000) scale(-1, 1) translate(-31.000000, -17.000000) ",points:"27 21 27 13 35 21"}),i.exports.createElement("path",{d:"M24,12 C30.627417,12 36,17.372583 36,24 C36,30.627417 30.627417,36 24,36 C22.8954305,36 22,35.1045695 22,34 C22,32.8954305 22.8954305,32 24,32 C28.418278,32 32,28.418278 32,24 C32,19.581722 28.418278,16 24,16 C19.581722,16 16,19.581722 16,24 C16,25.1045695 15.1045695,26 14,26 C12.8954305,26 12,25.1045695 12,24 C12,17.372583 17.372583,12 24,12 Z",id:"Oval",fill:"#FFFFFF",fillRule:"nonzero",transform:"translate(24.000000, 24.000000) scale(-1, 1) rotate(45.000000) translate(-24.000000, -24.000000) "}))),At=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-save"),i.exports.createElement("g",{id:"icon-save",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("path",{d:"M13,14 L13,34 C13,34.5522847 13.4477153,35 14,35 L34,35 C34.5522847,35 35,34.5522847 35,34 L35,16.4142136 C35,16.1489971 34.8946432,15.8946432 34.7071068,15.7071068 L32.2928932,13.2928932 C32.1053568,13.1053568 31.8510029,13 31.5857864,13 L14,13 C13.4477153,13 13,13.4477153 13,14 Z",id:"Path-15",stroke:"#FFFFFF",strokeWidth:2,strokeLinejoin:"round"}),i.exports.createElement("rect",{id:"Rectangle",stroke:"#FFFFFF",strokeWidth:2,strokeLinejoin:"round",x:17,y:25,width:14,height:10}),i.exports.createElement("path",{d:"M29,13 C29.5522847,13 30,13.4477153 30,14 L30,19 C30,19.5522847 29.5522847,20 29,20 L19,20 C18.4477153,20 18,19.5522847 18,19 L18,14 C18,13.4477153 18.4477153,13 19,13 L29,13 Z M28,14 L27,14 C26.4477153,14 26,14.4477153 26,15 L26,15 L26,18 C26,18.5522847 26.4477153,19 27,19 L27,19 L28,19 C28.5522847,19 29,18.5522847 29,18 L29,18 L29,15 C29,14.4477153 28.5522847,14 28,14 L28,14 Z",id:"Rectangle-Copy-3",fill:"#FFFFFF"}))),Rt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-swap-vertical"),i.exports.createElement("g",{id:"icon-swap-vertical",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("path",{d:"M20,9.47353678 L20,37 C20,37.5522847 19.5522847,38 19,38 L17,38 C16.4477153,38 16,37.5522847 16,37 L16,23 C16,22.4477153 15.5522847,22 15,22 L13.575782,22 C13.0234973,22 12.575782,21.5522847 12.575782,21 C12.575782,20.852792 12.6082826,20.7073995 12.6709633,20.574203 L18.0951813,9.04773974 C18.3303425,8.54802217 18.9260795,8.33355687 19.425797,8.56871808 C19.7762895,8.73365569 20,9.08617473 20,9.47353678 Z",id:"Path-8",fill:"#FFFFFF"}),i.exports.createElement("path",{d:"M36,14.4735368 L36,42 C36,42.5522847 35.5522847,43 35,43 L33,43 C32.4477153,43 32,42.5522847 32,42 L32,28 C32,27.4477153 31.5522847,27 31,27 L29.575782,27 C29.0234973,27 28.575782,26.5522847 28.575782,26 C28.575782,25.852792 28.6082826,25.7073995 28.6709633,25.574203 L34.0951813,14.0477397 C34.3303425,13.5480222 34.9260795,13.3335569 35.425797,13.5687181 C35.7762895,13.7336557 36,14.0861747 36,14.4735368 Z",id:"Path-8-Copy",fill:"#FFFFFF",transform:"translate(32.000000, 26.500000) rotate(180.000000) translate(-32.000000, -26.500000) "}))),Mt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-terrier"),i.exports.createElement("g",{id:"icon-terrier",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("path",{d:"M33.7602041,17.4224896 C33.3928571,18.7248636 33.0714286,19.679938 32.7959184,20.2877125 C32.6581633,21.8505614 32.5204082,23.93436 32.244898,25.4972088 C32.0612245,26.5391081 31.6938776,27.7546573 31.1428571,29.1438563 C31.2688026,33.0172946 31.3606393,35.1879181 31.4183673,35.6557267 C31.5049594,36.3574395 32.1071429,36.6976259 32.1071429,37.2185756 C32.1071429,37.7395252 31.8316327,38 30.4540816,38 C29.0765306,38 28.1122449,37.4790504 27.6989796,35.9162015 C27.4234694,34.8743022 27.2397959,33.8324029 27.1479592,32.7905037 C26.7806122,30.7935301 26.4591837,29.577981 26.1836735,29.1438563 C25.7704082,28.4926692 22.3265306,27.45077 19.9846939,27.45077 C17.6428571,27.45077 18.1938776,28.3624318 16.2653061,30.1857555 C14.3367347,32.0090792 13.2346939,32.6602663 12.5459184,33.7021655 C12.2216555,34.1926727 11.7193878,34.48359 11.7193878,35.3952518 C11.7193878,36.3069137 12.2704082,36.9428795 12.2704082,37.2185756 C12.2704082,37.5658753 11.7653061,37.8263501 10.755102,38 C9.56122449,38 8.82653061,37.8697626 8.55102041,37.6092878 C8.1377551,37.2185756 8,36.5673885 8,35.6557267 C8,35.0479521 8.22959184,33.8758154 8.68877551,32.1393166 C9.69897959,30.8369426 10.3877551,29.8818682 10.755102,29.2740937 C11.3061224,28.3624318 11.994898,24.8460218 12.2704082,23.4134103 C12.4540816,22.458336 12.9591837,21.6334991 13.7857143,20.9388996 C12.7755102,19.6365255 12.0867347,18.5946262 11.7193878,17.8132018 C11.1683673,16.6410651 10.8928571,14.687504 11.4438776,14.5572666 C11.994898,14.4270292 12.5459184,16.5108277 13.372449,17.552727 C13.9234694,18.2473265 14.6122449,18.8985135 15.4387755,19.5062881 C17.1836735,19.5062881 18.4693878,19.5062881 19.2959184,19.5062881 C20.5357143,19.5062881 22.1887755,19.6365255 23.5663265,19.2458133 C24.9438776,18.8551011 26.4591837,18.203914 27.9744898,16.3805903 C29.4897959,14.5572666 31.005102,11.9525184 32.3826531,11.4315688 C33.7602041,10.9106192 35.4132653,10.9106192 35.5510204,11.171094 C35.6887755,11.4315688 35.4132653,12.0827558 35.8265306,12.3432307 C36.2397959,12.6037055 37.0663265,13.1246551 37.0663265,13.3851299 C37.0663265,13.6456047 37.0663265,14.036317 38.1683673,14.8177414 C39.2704082,15.5991659 39.9591837,16.2503529 39.9591837,17.1620147 C39.9591837,18.0736766 38.5816327,20.4029146 37.4795918,20.6633894 C36.377551,20.9238642 35.5510204,19.2653061 35.1377551,18.3341514 C34.6785714,18.0736766 34.2193878,17.7697893 33.7602041,17.4224896 Z",id:"Path-2",fill:"#FFFFFF"}))),m={BlankDocument:yt,Close:ft,Delete:gt,Download:Ct,Github:wt,Open:Et,PlusEntity:bt,PlusAttribute:vt,PlusAssociation:Lt,Undo:Ft,Upload:St,Redo:kt,Save:At,SwapVertical:Rt,Terrier:Mt};class Nt extends i.exports.Component{constructor(t){super(t);this.state={fileName:this.props.source.fileName}}componentDidMount(){this.setState({fileName:this.props.source.fileName})}render(){const t=this.props.ui.history;return i.exports.createElement("div",{id:"topbar"},i.exports.createElement("a",{className:"logo",onClick:()=>this.props.onOpen()},i.exports.createElement(_,null)),i.exports.createElement("div",{className:"spacer"}),i.exports.createElement("a",{className:"action",title:"Open",onClick:()=>this.props.onOpen()},i.exports.createElement(m.Open,null)),i.exports.createElement("div",{className:"text-field"},i.exports.createElement("input",{type:"text",className:"file-name",onChange:this.onFileNameChanged.bind(this),value:this.state.fileName})),i.exports.createElement("a",{className:"action",title:"Save",onClick:this.save.bind(this)},i.exports.createElement(m.Save,null)),i.exports.createElement("a",{className:"action",title:"Download",onClick:this.download.bind(this)},i.exports.createElement(m.Download,null)),i.exports.createElement("div",{className:"spacer"}),i.exports.createElement("a",{className:`action ${t.canUndo()?"":"inactive"}`,onClick:()=>t.undo()},i.exports.createElement(m.Undo,null)),i.exports.createElement("a",{className:`action ${t.canRedo()?"":"inactive"}`,onClick:()=>t.redo()},i.exports.createElement(m.Redo,null)),i.exports.createElement("a",{className:"action",onMouseDown:this.startNewEntity.bind(this),onClick:()=>alert("Drag this icon onto the canvas to add a new entity")},i.exports.createElement(m.PlusEntity,null)))}startNewEntity(t){this.props.ui.interactor.beginNewEntity()}save(){this.props.source.save(this.props.schema)}download(){this.props.source.export(this.props.schema)}onFileNameChanged(t){this.props.source.fileName=t.currentTarget.value,this.setState({fileName:this.props.source.fileName})}}function M(n,t){return{x:n||0,y:t||0}}function Q(n,t){return{x:n.x+t.x,y:n.y+t.y}}function F(n,t){return{x:n.x-t.x,y:n.y-t.y}}function S(n){return{x:Math.round(n.x),y:Math.round(n.y)}}function Pt(n){if(!n.length)return{x:0,y:0};let t=n[0];for(let e of n)t={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)};return t}function $t(n){if(!n.length)return{x:0,y:0};let t=n[0];for(let e of n)t={x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)};return t}function P(n,t){return n.x*t.y-n.y*t.x}function k(n,t){const e=n[0],s=t[0],o=F(n[1],n[0]),r=F(t[1],t[0]),a=P(o,r);if(a==0)return null;const l=P(F(s,e),r)/a,c=P(F(s,e),o)/a;return c>=0&&c<=1&&l>=0&&l<=1?{x:s.x+c*r.x,y:s.y+c*r.y}:null}class O{constructor(t,e,s,o){this.x=t,this.y=e,this.width=s,this.height=o}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}isWithin(t){return this.x>=t.x&&this.y>=t.y&&this.right<=t.right&&this.bottom<=t.bottom}}function V(n){return{x:(n.left+n.right)/2,y:(n.top+n.bottom)/2}}function D(n){if(!n.length)throw"Must provide at least one point for the rectangle!";let t=null,e=null,s=null,o=null;for(let r of n)t=t?Math.min(t,r.x):r.x,e=e?Math.min(e,r.y):r.y,s=s?Math.max(s,r.x):r.x,o=o?Math.max(o,r.y):r.y;return new O(t,e,s-t,o-e)}function Dt(n,t){return t.x>=n.left&&t.x<=n.right&&t.y>=n.top&&t.y<=n.bottom}function zt(n){return{ne:{x:n.right,y:n.top},nw:{x:n.left,y:n.top},se:{x:n.right,y:n.bottom},sw:{x:n.left,y:n.bottom}}}class It extends i.exports.Component{constructor(t){super(t)}render(){const t=this.props.config,e=this.props.attribute,s=this.props.width,o=e.state,r=this.props.x,a=this.props.y;this.props.attribute.position=M(r,a);const l=a+t.lineHeight/2+1,c=o.isRequired?"required":"",h=this.props.index%2==0?t.evenBgColor:t.oddBgColor;return i.exports.createElement("g",{className:`attribute ${c}`,id:e.id,onClick:this.onClicked.bind(this),onDoubleClick:this.onDoubleClicked.bind(this)},i.exports.createElement("rect",{x:r,y:a,width:s,height:t.lineHeight,stroke:"transparent",fill:h}),i.exports.createElement("text",{className:"attribute-name",x:r+t.padding,y:l},o.name),i.exports.createElement("text",{className:"attribute-type",x:r+s-t.padding,y:l},o.type))}onClicked(t){t.stopPropagation(),this.props.ui.interactor.onAttributeClicked(this.props.attribute,t)}onDoubleClicked(t){t.stopPropagation(),this.props.ui.interactor.onAttributeDoubleClicked(this.props.attribute,t)}}class Ot extends i.exports.Component{constructor(t){super(t)}render(){const t=this.props.config,e=this.props.entity,s=e.width/2,o=e.left,r=this.props.y,a=this.props.config.iconSize,l={transform:`translate(${o+s/2-a/2}px,${r}px)`};return i.exports.createElement("g",{className:"new-button",id:`${e.id}-new-attribute`,onMouseDown:this.onClicked.bind(this)},i.exports.createElement("rect",{x:o,y:r,width:s,height:t.lineHeight,stroke:"transparent"}),i.exports.createElement("g",{className:"icon-container",style:l},i.exports.createElement(m.PlusAttribute,null)))}onClicked(t){t.stopPropagation(),this.props.ui.interactor.onNewAttributeClicked(this.props.entity)}}class Tt extends i.exports.Component{constructor(t){super(t)}render(){const t=this.props.config,e=this.props.entity,s=e.width/2,o=e.left+s,r=this.props.y,a=this.props.config.iconSize,l={transform:`translate(${o+s/2-a/2}px,${r}px)`};return i.exports.createElement("g",{className:"new-button",id:`${e.id}-new-attribute`,onMouseDown:this.onMouseDown.bind(this),onClick:this.onClicked.bind(this)},i.exports.createElement("rect",{x:o,y:r,width:s,height:t.lineHeight,stroke:"transparent"}),i.exports.createElement("g",{className:"icon-container",style:l},i.exports.createElement(m.PlusAssociation,null)))}onMouseDown(t){t.stopPropagation(),this.props.ui.interactor.onNewAssociationPressed(this.props.entity)}onClicked(t){t.stopPropagation(),alert("Drag this button to create a new association")}}class qt extends i.exports.Component{constructor(t){super(t)}render(){const t=this.props.config,e=this.props.entity,[s,o]=e.size,r=e.state,a=t.lineHeight,l=t.borderSize,c=t.color(r.color);let h=0,d=r.y;const x=r.y+a/2+1,N=e.mapAttributes(Z=>(d+=a,h+=1,i.exports.createElement(It,{key:Z.id,config:t,ui:this.props.ui,width:s-2*l,x:r.x+l,y:d,index:h,attribute:Z})));return d+=a,d=Math.max(d,r.y+o-t.lineHeight),i.exports.createElement("g",{className:"entity",id:e.id,"data-color":e.state.color,onClick:this.onClicked.bind(this),onDoubleClick:this.onDoubleClicked.bind(this),onMouseDown:this.onMouseDown.bind(this)},i.exports.createElement("rect",{className:"entity-background",x:r.x,y:r.y,width:s,height:o,stroke:"transparent",fill:c}),i.exports.createElement("rect",{className:"entity-name-bar",x:r.x,y:r.y,width:s,height:a,stroke:"transparent",fill:"transparent"})," ",i.exports.createElement("text",{className:"entity-name",x:r.x+s/2,y:x},r.name),i.exports.createElement("rect",{className:"attributes-background",width:s-2*l,x:r.x+l,y:r.y+a,height:d-r.y-l}),N,i.exports.createElement(Ot,{config:t,ui:this.props.ui,y:d,entity:e}),i.exports.createElement(Tt,{config:t,ui:this.props.ui,y:d,entity:e}))}onClicked(t){this.props.ui.interactor.onEntityClicked(this.props.entity,t)}onMouseDown(t){t.stopPropagation(),this.props.ui.interactor.onEntityMouseDown(this.props.entity,t)}onDoubleClicked(t){this.props.ui.interactor.onEntityDoubleClicked(this.props.entity,t)}}class tt extends i.exports.Component{render(){var l;const t=this.props.path,e=this.props.fromSide,s=this.props.toSide;let o=!1,r={fromId:"",fromArity:"",toId:"",toArity:""};const a=["association"];if(this.props.association){o=this.props.ui.selection.isAssociationSelected(this.props.association);const c=this.props.association.sides;r={fromId:c[0].entityId,fromArity:c[0].arity,toId:c[1].entityId,toArity:c[1].arity},o&&a.push("selected"),this.props.association.state.isRequired||a.push("optional")}return i.exports.createElement("g",{className:a.join(" "),id:(l=this.props.association)==null?void 0:l.id,"data-from-id":r.fromId,"data-from-arity":r.fromArity,"data-to-id":r.toId,"data-to-arity":r.toArity,onMouseDown:this.onClicked.bind(this)},i.exports.createElement("polyline",{className:"main invisible",points:t.svgPoints}),i.exports.createElement("polyline",{className:"main line",points:t.svgPoints}),e.arity=="many"&&this.renderChickenFoot(t.firstPoint,t.fromDir),s.arity=="many"&&this.renderChickenFoot(t.lastPoint,t.toDir))}renderChickenFoot(t,e){const s=this.props.config.gridSize;let o=[];switch(e){case"n":o=[{x:t.x-s+1,y:t.y+1},{x:t.x,y:t.y-s},{x:t.x+s-1,y:t.y+1}];break;case"s":o=[{x:t.x-s+1,y:t.y-1},{x:t.x,y:t.y+s},{x:t.x+s-1,y:t.y-1}];break;case"e":o=[{x:t.x-1,y:t.y-s+1},{x:t.x+s,y:t.y},{x:t.x-1,y:t.y+s-1}];break;case"w":o=[{x:t.x+1,y:t.y-s+1},{x:t.x-s,y:t.y},{x:t.x+1,y:t.y+s-1}];break}const r=o.map(a=>`${a.x},${a.y}`).join(" ");return i.exports.createElement("polyline",{className:"foot line",key:e,points:r})}onClicked(t){this.props.association&&(t.stopPropagation(),this.props.ui.interactor.onAssociationClicked(this.props.association))}}const Bt=["n","s","e","w"];function W(n,t){return t=="s"||t=="n"?n.x:n.y}function Zt(n,t,e){return t=="s"||t=="n"?{x:e,y:n.y}:{x:n.x,y:e}}function Ut(n,t){return t=="s"||t=="n"?[n.left,n.right]:[n.top,n.bottom]}class jt{constructor(t,e,s){this.id=t,this.fromId=e,this.toId=s,this.points=[],this.fromDir="e",this.toDir="e"}get svgPoints(){return this.points.map(t=>`${t.x},${t.y}`).join(" ")}get firstPoint(){return this.points[0]}get lastPoint(){return this.points[this.points.length-1]}get bounds(){return D(this.points)}}class et{constructor(t){this.config=t,this.rects={},this.lines=[]}addLine(t,e,s,o,r){this.rects[e]=s,this.rects[o]=r,this.lines.push(new jt(t,e,o))}findEdge(t,e,s,o){const r=zt(s);let a=null;const l=this.config.gridSize;return(a=k(t,[r.nw,r.ne]))?(a={x:Math.min(Math.max(a.x,s.left+l),s.right-l),y:a.y},e.points[o]=S(a),"n"):(a=k(t,[r.ne,r.se]))?(a={x:a.x,y:Math.min(Math.max(a.y,s.top+l),s.bottom-l)},e.points[o]=S(a),"e"):(a=k(t,[r.se,r.sw]))?(a={x:Math.min(Math.max(a.x,s.left+l),s.right-l),y:a.y},e.points[o]=S(a),"s"):(a=k(t,[r.sw,r.nw]))?(a={x:a.x,y:Math.min(Math.max(a.y,s.top+l),s.bottom-l)},e.points[o]=S(a),"w"):null}squareOut(t,e,s){const o=this.config.gridSize,r=t.points,a=[t.fromDir,t.toDir].sort().join(""),l=(r[0].x+r[1].x)/2,c=(r[0].y+r[1].y)/2;switch(a){case"ew":c>=e.top+o&&c>=s.top+o&&c<=e.bottom-o&&c<=s.bottom-o?(t.points[0]={x:r[0].x,y:c},t.points[1]={x:r[1].x,y:c}):t.points=[r[0],{x:l,y:r[0].y},{x:l,y:r[1].y},r[1]];return;case"ns":l>=e.left+o&&l>=s.left+o&&l<=e.right-o&&l<=s.right-o?(t.points[0]={x:l,y:r[0].y},t.points[1]={x:l,y:r[1].y}):t.points=[r[0],{x:r[0].x,y:c},{x:r[1].x,y:c},r[1]];return;case"en":t.points=[r[0],{x:Math.max(r[0].x,r[1].x),y:Math.min(r[0].y,r[1].y)},r[1]];return;case"nw":t.points=[r[0],{x:Math.min(r[0].x,r[1].x),y:Math.min(r[0].y,r[1].y)},r[1]];return;case"es":t.points=[r[0],{x:Math.max(r[0].x,r[1].x),y:Math.max(r[0].y,r[1].y)},r[1]];return;case"sw":t.points=[r[0],{x:Math.min(r[0].x,r[1].x),y:Math.max(r[0].y,r[1].y)},r[1]];return;default:throw`Don't know how to square out directions '${a}'`}}spreadSides(t,e,s,o){const r=Ut(s,o),a=this.config.gridSize,l=[];for(let c of t)c.fromId==e&&c.fromDir==o&&l.push({index:0,v:W(c.firstPoint,o),line:c}),c.toId==e&&c.toDir==o&&l.push({index:c.points.length-1,v:W(c.lastPoint,o),line:c});if(l.length>1){l.sort((h,d)=>h.v-d.v);let c=r[1]-r[0];for(let h=0;h<l.length-1;h++)c=Math.min(c,l[h+1].v-l[h].v);if(c<a){const h=(r[1]-r[0])/l.length;for(let d in l){const x=l[d];x.line.points[x.index]=Zt(x.line.points[x.index],o,r[0]+(parseInt(d)+.5)*h)}}}}layout(){let t=[];for(let e of this.lines){const s=this.rects[e.fromId],o=this.rects[e.toId];e.points=[V(s),V(o)];const r=[e.points[0],e.points[1]];let a=null,l=!0;if((a=this.findEdge(r,e,s,0))?e.fromDir=a:l=!1,(a=this.findEdge(r,e,o,1))?e.toDir=a:l=!1,!l)continue;const c=e.bounds;(c.width>this.config.gridSize||c.height>this.config.gridSize)&&t.push(e)}Object.entries(this.rects).forEach(e=>{for(let s of Bt)this.spreadSides(t,e[0],e[1],s)});for(let e of t){const s=this.rects[e.fromId],o=this.rects[e.toId];this.squareOut(e,s,o)}return t}}class Vt extends i.exports.Component{constructor(t){super(t)}render(){const t=this.props.config,e=this.props.schema,s=e.mapEntities(c=>(c.computeSize(t),i.exports.createElement(qt,{key:c.id,config:this.props.config,ui:this.props.ui,entity:c}))),o=new et(t);e.mapAssociations(c=>{const h=c.entities;o.addLine(c.id,h[0].id,h[0],h[1].id,h[1])});const a=o.layout().map(c=>{const h=e.getAssociation(c.id),d=h.sides;return h.linePath=c,i.exports.createElement(tt,{key:h.id,config:this.props.config,ui:this.props.ui,path:c,fromSide:d[0],toSide:d[1],association:h})}),l=`
		.entity {
		}
		.entity-name {
			font: bold ${t.fontSize}px ${t.fontFamily};
			fill: #ffffff;
			text-anchor: middle;
			dominant-baseline: middle;
			text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
		}
		.entity-background {
			rx: ${t.entityRadius};
		}
		.attributes-background {
			fill: #fff;
			rx: ${t.attributeRadius};
		}
		.attribute-name {
			font: ${t.fontSize}px ${t.fontFamily};
			fill: ${t.fgColor};
			text-anchor: start;
			dominant-baseline: middle;
		}
		.attribute-type {
			font: ${t.fontSize}px ${t.fontFamily};
			fill: ${t.primaryColor};
			text-anchor: end;
			dominant-baseline: middle;
		}
		.attribute.required .attribute-name {
			font: bold ${t.fontSize}px ${t.fontFamily};
		}
		.new-button > rect {
			fill: transparent;
			rx: ${t.entityRadius};
		}
		.new-button svg g rect, .new-button svg g path {
			fill: ${t.hintFgColor};
		}
		.association polyline.line {
			stroke: ${t.fgColor};
			fill: none;
			stroke-width: 2px;
		}
		.association polyline.invisible {
			stroke-width: ${t.lineHeight};
			fill: none;
			stroke: transparent;
		}
		.association.optional polyline {
			stroke-dasharray: ${t.dashSize} ${t.dashSize};
		}
		`;return i.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:t.planeSize,height:t.planeSize,id:"document"},i.exports.createElement("style",null,l),i.exports.createElement("rect",{className:"plane-background",fill:"transparent",x:"0",y:"0",width:t.planeSize,height:t.planeSize}),i.exports.createElement("g",{id:"associations"},a),i.exports.createElement("g",{id:"entities"},s))}}const z=class{constructor(n,t,e){this.state=t,e?(this.id=e,z.bumpCount(n,e)):this.id=z.getId(n)}static newGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,e=n=="x"?t:t&3|8;return e.toString(16)})}static getId(n){return n=="schema"?this.newGuid():(this.idCounts[n]?this.idCounts[n]+=1:this.idCounts[n]=1,`${n}-${this.idCounts[n]}`)}static bumpCount(n,t){const e=t.split("-");if(e.length>1){const s=parseInt(e[1]);this.idCounts[n]?this.idCounts[n]=Math.max(this.idCounts[n],s):this.idCounts[n]=s+1}}};let v=z;v.idCounts={};class Wt{constructor(t,e){this.ui=t,this.config=e,this.actionSets=[],this.index=-1}numActions(){return this.actionSets.length}pushAction(t){this.pushSet(new Set([t]))}pushActions(t){this.pushSet(new Set(t))}pushSet(t){this.index>=this.numActions()&&(this.actionSets=this.actionSets.slice(0,this.index)),this.actionSets.push(t),this.index=this.actionSets.length-1,this.applySet(t),console.log(`action history at ${this.index}`)}applySet(t){t.forEach(e=>{e.apply(this.config,this.ui)}),this.ui.requestRender(u.RenderType.App)}unapplySet(t){t.forEach(e=>{e.unapply(this.config,this.ui)}),this.ui.requestRender(u.RenderType.App)}canUndo(){return this.index>-1}undo(){if(console.log("undo"),this.index<0)return!1;const t=this.actionSets[this.index];return this.unapplySet(t),this.ui.requestRender(u.RenderType.App),this.index-=1,console.log(`action history at ${this.index}`),!0}canRedo(){return this.index<this.numActions()-1}redo(){if(console.log("redo"),this.index>=this.numActions()-1)return!1;this.index+=1;const t=this.actionSets[this.index];return this.applySet(t),console.log(`action history at ${this.index}`),!0}}class y{}class A extends v{constructor(t,e,s=null){super("attribute",e,s);this.entity=t,this.position=M(0,0),t.registerAttribute(this)}static fromRaw(t,e){const s=g.fromRaw(e);return new A(t,s)}get raw(){return g.toRaw(this.state)}}class g{constructor(t,e="text",s=!1){this.name=t,this.type=e,this.isRequired=s}static fromRaw(t){const e=t.split(":");let s=e[0].trim(),o="text";e.length>1&&(o=e[1].trim());let r=!1;return s.indexOf("*")>-1&&(r=!0,s=s.replace(/\*/g,"")),new g(s,o,r)}static toRaw(t){const e=t.isRequired?"*":"";return`${t.name}${e}: ${t.type}`}}class Ht extends y{constructor(t,e,s){super();this.attribute=t,this.fromState=e,this.toState=s}apply(){this.attribute.state=this.toState}unapply(){this.attribute.state=this.fromState}hasChanges(){return g.toRaw(this.fromState)!=g.toRaw(this.toState)}}class Xt extends y{constructor(t,e){super();this.entity=t,this.raw=e}apply(){this.attribute=this.entity.newAttributeFromRaw(this.raw)}unapply(){this.attribute&&this.entity.removeAttribute(this.attribute.id)}hasChanges(){return this.raw.length>0}}class Kt extends y{constructor(t){super();this.attribute=t,this.entity=t.entity}apply(){this.entity.removeAttribute(this.attribute.id)}unapply(){this.attribute=this.entity.newAttributeFromRaw(this.attribute.raw)}hasChanges(){return!0}}const it=["left","right","horizontalCenter","top","bottom","verticalCenter"];class Gt extends v{constructor(t,e=new Yt,s=null){super("entity",e,s);this.schema=t,this.attributes={},this.size=[0,0],t.registerEntity(this)}computeSize(t){let e=t.measureText(this.state.name,"bold").width+2*t.padding;this.mapAttributes(o=>{let r=t.measureText(o.state.name,"bold").width+t.measureText(o.state.type).width+4*t.padding;e=Math.max(e,r)});const s=(this.numAttributes()+2)*t.lineHeight;return this.size=[Math.max(t.minEntitySize,t.snapUpEven(e)),Math.max(t.minEntitySize,t.snapUpEven(s))]}get width(){return this.size[0]}get height(){return this.size[1]}moveTo(t,e){this.state.x=t,this.state.y=e}get left(){return this.state.x}get right(){return this.state.x+this.size[0]}get horizontalCenter(){return this.state.x+this.size[0]/2}get top(){return this.state.y}get bottom(){return this.state.y+this.size[1]}get verticalCenter(){return this.state.y+this.size[1]/2}getPosition(t){switch(t){case"left":return this.left;case"right":return this.right;case"horizontalCenter":return this.horizontalCenter;case"top":return this.top;case"bottom":return this.bottom;case"verticalCenter":return this.verticalCenter}}snapPosition(t){this.moveTo(t.snapNearest(this.state.x),t.snapNearest(this.state.y))}registerAttribute(t){this.attributes[t.id]=t}removeAttribute(t){delete this.attributes[t]}numAttributes(){return Object.entries(this.attributes).length}newAttribute(t,e=null){return new A(this,t,e)}newAttributeFromRaw(t){return A.fromRaw(this,t)}getAttribute(t){return this.attributes[t]}attributesInOrder(){return Object.entries(this.attributes).sort((e,s)=>e[1].state.name>s[1].state.name?1:-1).map(e=>e[1])}mapAttributes(t){return this.attributesInOrder().map(t)}firstAttribute(){return this.attributesInOrder()[0]}lastAttribute(){const t=this.attributesInOrder();return t[t.length-1]}previousAttribute(t){let e;return this.attributesInOrder().reverse().forEach(s=>{!e&&s.state.name<t.state.name&&(e=s)}),e}nextAttribute(t){let e;return this.attributesInOrder().forEach(s=>{!e&&s.state.name>t.state.name&&(e=s)}),e}isWithin(t){return new O(this.state.x,this.state.y,this.size[0],this.size[1]).isWithin(t)}}class Yt{constructor(){this.name="",this.x=0,this.y=0,this.color="blue"}}class Jt extends y{constructor(t,e){super();this.schema=t,this.state=e}apply(t,e){this.entity?this.schema.addEntity(this.entity):this.entity=this.schema.newEntity(this.state),e.selection.addEntity(this.entity),this.entity.state.name.length||e.interactor.editEntityName(this.entity)}unapply(t,e){this.entity&&this.schema.removeEntity(this.entity.id)}hasChanges(){return!0}}class T extends y{constructor(t,e,s){super();this.entity=t,this.fromState=e,this.toState=s}apply(t,e){this.entity.state=this.toState}unapply(t,e){this.entity.state=this.fromState}hasChanges(){return this.fromState.x!=this.toState.x||this.fromState.y!=this.toState.y||this.fromState.name!=this.toState.name}}class _t extends y{constructor(t){super();this.entity=t,this.schema=t.schema}apply(t,e){this.schema.removeEntity(this.entity.id)}unapply(t,e){this.schema.addEntity(this.entity)}hasChanges(){return!0}}class st extends v{constructor(t,e,s=null){super("association",e,s);this.schema=t,this.linePath=null,t.registerAssociation(this)}get entities(){return Object.entries(this.state.sides).map(t=>this.schema.getEntity(t[0]))}get sides(){return Object.values(this.state.sides)}}function H(n){return n=="one"?"many":"one"}class I{constructor(t,e="one"){this.entityId=t,this.arity=e}}class b{constructor(t,e,s=!0){this.isRequired=s,this.sides={},this.sides[t.entityId]=t,this.sides[e.entityId]=e}}class Qt{constructor(t){this.schema=t,this.sides=[],this.isRequired=!0}add(t,e="one"){return this.sides.push(new I(t.id,e)),this}build(){if(this.sides.length!=2)throw"Must call add() twice!";return new st(this.schema,new b(this.sides[0],this.sides[1],this.isRequired))}}class te extends y{constructor(t,e){super();this.schema=t,this.state=e}apply(t,e){this.association?this.schema.addAssociation(this.association):this.association=this.schema.newAssociation(this.state),e.selection.addAssociation(this.association,!1)}unapply(t,e){this.association&&this.schema.removeAssociation(this.association.id)}hasChanges(){return!0}}class X extends y{constructor(t,e,s){super();this.association=t,this.fromState=e,this.toState=s}apply(t,e){this.association.state=this.toState}unapply(t,e){this.association.state=this.fromState}hasChanges(){const{fromFirstSide:t,fromLastSide:e}=this.fromState.sides,{toFirstSide:s,toLastSide:o}=this.toState.sides;return t.arity!=s.arity||e.arity!=o.arity||this.fromState.isRequired!=this.toState.isRequired}}class K extends y{constructor(t){super();this.association=t,this.schema=t.schema}apply(t,e){this.schema.removeAssociation(this.association.id)}unapply(t,e){this.schema.addAssociation(this.association)}hasChanges(){return!0}}class ee{constructor(t){this.ui=t,this.mode=0,this.entities={},this.associations={}}clear(){return this.entities={},this.associations={},this.ui.requestRender(u.RenderType.App),this}numEntites(){return Object.entries(this.entities).length}isEntitySelected(t){return this.entities[t.id]!=null}addEntity(t,e=!1){!e&&this.mode==0&&this.clear(),this.entities[t.id]=t,this.ui.requestRender(u.RenderType.App)}selectAll(){this.ui.schema.mapEntities(t=>{this.entities[t.id]=t}),this.ui.requestRender(u.RenderType.App)}get allEntities(){return Object.entries(this.entities).map(t=>t[1])}mapEntities(t){return Object.entries(this.entities).map(e=>t(e[1]))}deleteEntities(){const t=Object.keys(this.entities),e=this.mapEntities(s=>new _t(s));for(let s of t)this.ui.schema.mapAssociations(o=>{for(let r of o.sides)r.entityId==s&&e.push(new K(o))});this.ui.history.pushActions(e),this.clear()}numAssociations(){return Object.entries(this.associations).length}isAssociationSelected(t){return this.associations[t.id]!=null}addAssociation(t,e=!1){!e&&this.mode==0&&(this.associations={}),this.associations[t.id]=t,this.ui.requestRender(u.RenderType.App)}mapAssociations(t){return Object.entries(this.associations).map(e=>t(e[1]))}get allAssociations(){return Object.entries(this.associations).map(t=>t[1])}deleteAssociations(){const t=this.mapAssociations(e=>new K(e));this.ui.history.pushActions(t),this.clear()}renderOverlay(){const t=this.mapEntities(e=>{const s=e.size,o={width:s[0]+2,height:s[1]+2,top:e.top-1,left:e.left-1};return i.exports.createElement("div",{className:"entity-overlay",key:e.id,style:o})});return i.exports.createElement("div",{className:"selection"},t)}}class ie{constructor(t,e){this.ui=t,this.config=e}onCanvasMouseDown(t){this.proxy||(this.proxy=new se(this,t))}onCanvasMouseMove(t){t.buttons&&this.proxy&&(this.proxy.onMouseMove(t),this.ui.requestRender(u.RenderType.Overlay))}onCanvasMouseUp(t){this.proxy&&this.proxy.onMouseUp(t)&&this.clearProxy()}onCanvasDoubleClicked(t){this.clearProxy(),this.ui.selection.clear()}onEntityMouseDown(t,e){this.proxy||(this.ui.selection.addEntity(t,e.shiftKey||this.ui.selection.isEntitySelected(t)),this.proxy=new ne(this,e))}onEntityClicked(t,e){}onEntityDoubleClicked(t,e){this.editEntityName(t),e.stopPropagation()}onAttributeClicked(t,e){}onAttributeDoubleClicked(t,e){this.editAttribute(t),e.stopPropagation()}editEntityName(t){this.clearProxy(),this.proxy=new $(this,t)}editAttribute(t){this.clearProxy(),this.proxy=new E(this,t)}editFirstAttribute(t){let e=t.firstAttribute();e?this.proxy=new E(this,e):this.addNewAttribute(t),this.ui.requestRender(u.RenderType.Viewport)}editLastAttribute(t){let e=t.lastAttribute();e?this.proxy=new E(this,e):this.proxy=new $(this,t),this.ui.requestRender(u.RenderType.Viewport)}editPreviousAttribute(t){let e=t.entity.previousAttribute(t);e?this.proxy=new E(this,e):this.proxy=new $(this,t.entity),this.ui.requestRender(u.RenderType.Viewport)}editNextAttribute(t){let e=t.entity.nextAttribute(t);e?this.proxy=new E(this,e):this.onNewAttributeClicked(t.entity),this.ui.requestRender(u.RenderType.Viewport)}addNewAttribute(t){this.proxy=new ae(this,t),this.ui.requestRender(u.RenderType.Viewport)}onNewAttributeClicked(t){this.addNewAttribute(t)}onNewAssociationPressed(t){this.clearProxy(),this.proxy=new le(this,t)}onAssociationClicked(t){this.ui.selection.clear().addAssociation(t)}beginNewEntity(){this.proxy=new oe(this,this.ui.schema),this.ui.requestRender(u.RenderType.Viewport)}render(){return this.proxy?this.proxy.renderOverlay():i.exports.createElement("div",{className:"select-interactor"})}afterRender(){this.proxy&&this.proxy.afterRender()}eventRelativePosition(t){const s=t.currentTarget.getBoundingClientRect();return M(t.clientX-s.left,t.clientY-s.top)}clearProxy(){this.proxy&&(this.proxy=void 0,this.ui.requestRender(u.RenderType.App))}}class L{constructor(t){this.interactor=t,this.config=t.config}onMouseMove(t){return!1}onMouseUp(t){return!1}afterRender(){}}class se extends L{constructor(t,e){super(t);this.hasMoved=!1,this.selection=t.ui.selection,e.shiftKey||this.selection.clear(),this.initialPos=this.interactor.eventRelativePosition(e),this.range=D([this.initialPos])}updateRange(t){const e=this.interactor.eventRelativePosition(t);this.range=D([e,this.initialPos])}onMouseMove(t){return this.updateRange(t),this.hasMoved=!0,!1}onMouseUp(t){return this.updateRange(t),this.interactor.ui.schema.mapEntities(e=>{e.isWithin(this.range)&&this.selection.addEntity(e,!0)}),!0}renderOverlay(){if(!this.hasMoved)return i.exports.createElement("div",null);const t={left:this.range.x,top:this.range.y,width:this.range.width,height:this.range.height};return i.exports.createElement("div",{className:"select-interactor rubber-band",style:t})}}class ne extends L{constructor(t,e){super(t);this.initialStates={},this.guides=[],this.selection=t.ui.selection,this.selection.mapEntities(s=>{this.initialStates[s.id]=p({},s.state)}),this.diffPos=M(0,0)}onMouseMove(t){return this.diffPos=Q(this.diffPos,{x:t.movementX,y:t.movementY}),this.selection.mapEntities(e=>{let s=this.initialStates[e.id];e.moveTo(s.x+this.diffPos.x,s.y+this.diffPos.y)}),this.computeGuides(),this.interactor.ui.requestRender(u.RenderType.Viewport),!1}onMouseUp(t){const e=this.selection.mapEntities(s=>(s.snapPosition(this.interactor.config),new T(s,this.initialStates[s.id],s.state)));return this.guides=[],e.map(s=>s.hasChanges()).includes(!0)?this.interactor.ui.history.pushActions(e):this.interactor.ui.requestRender(u.RenderType.Viewport),!0}renderOverlay(){return i.exports.createElement("div",{className:"select-interactor"},this.guides.map((t,e)=>i.exports.createElement(re,w(p({},t),{key:`guide-${e}`}))))}computeGuides(){this.guides=[];const t=this.interactor.ui.schema.filterEntities(e=>!this.selection.isEntitySelected(e));for(let e of it){let s=this.selection.mapEntities(o=>this.interactor.config.snapNearest(o.getPosition(e)));s=[...new Set(s)],t.forEach(o=>{const r=o.getPosition(e);s.indexOf(r)>-1&&this.guides.push({positionType:e,xy:r})})}}}class re extends i.exports.Component{render(){const t=this.props.positionType,e=it.indexOf(t)<3?"left":"top",s={};return s[e]=this.props.xy,i.exports.createElement("div",{className:`guide ${t}`,style:s})}}class oe extends L{constructor(t,e){super(t);this.schema=e}onMouseMove(t){return this.position=this.interactor.eventRelativePosition(t),!1}onMouseUp(t){if(!this.position)return!0;const e={name:"",x:this.config.snapNearest(this.position.x-this.config.minEntitySize/2),y:this.config.snapNearest(this.position.y-this.config.minEntitySize/2),color:"blue"},s=new Jt(this.schema,e);return this.interactor.ui.history.pushAction(s),!1}renderOverlay(){if(!this.position)return i.exports.createElement("div",{id:"new-entity-proxy"});const t=this.interactor.config.iconSize,e={top:this.position.y-t/2,left:this.position.x-t/2};return i.exports.createElement("div",{id:"new-entity-proxy",style:e},i.exports.createElement(m.PlusEntity,null))}}class nt extends L{constructor(t,e){super(t);this.entity=e,this.input=i.exports.createRef()}onKeyPress(t){switch(t.key){case"Enter":this.commit(t.currentTarget.value);return;case"Escape":this.interactor.clearProxy();return}}onKeyDown(t){switch(t.key){case"Escape":t.preventDefault(),this.interactor.clearProxy();return;case"ArrowUp":t.preventDefault(),this.onUp();return;case"ArrowDown":t.preventDefault(),this.onDown();return}}afterRender(){var t;(t=this.input.current)==null||t.focus()}renderOverlay(){const t=this.interactor.config,e=this.position,s={left:e.x,top:e.y,width:this.entity.width,height:t.lineHeight},o={width:"100%"};return i.exports.createElement("div",{className:this.className,key:this.key,style:s},i.exports.createElement("input",{type:"text",ref:this.input,defaultValue:this.defaultValue,placeholder:this.placeholder,style:o,onKeyPress:this.onKeyPress.bind(this),onKeyDown:this.onKeyDown.bind(this)}),this.renderTip())}get placeholder(){return""}}class $ extends nt{constructor(t,e){super(t,e);this.entity=e}get position(){return{x:this.entity.left,y:this.entity.top}}get className(){return"entity-name-field text-field"}get key(){return`edit-${this.entity.id}`}get defaultValue(){return this.entity.state.name}get placeholder(){return"Entity Name"}renderTip(){return i.exports.createElement("div",{className:"tip"},i.exports.createElement("div",{className:"line"},i.exports.createElement("div",{className:"required"},"Table or Class")))}onUp(){this.interactor.addNewAttribute(this.entity)}onDown(){this.interactor.editFirstAttribute(this.entity)}commit(t){const e=p({},this.entity.state);if(e.name=t.trim(),e.name.length>0&&e.name!=this.entity.state.name){const s=new T(this.entity,this.entity.state,e);this.interactor.ui.history.pushAction(s)}this.interactor.clearProxy(),this.interactor.editFirstAttribute(this.entity)}}class rt extends nt{get placeholder(){return"name: type"}renderTip(){return i.exports.createElement("div",{className:"tip"},i.exports.createElement("div",{className:"line"},i.exports.createElement("span",{className:"required"},"required*"),": type"),i.exports.createElement("div",{className:"line"},"optional: type"))}}class E extends rt{constructor(t,e){super(t,e.entity);this.attribute=e}get position(){return{x:this.attribute.position.x-this.config.borderSize,y:this.attribute.position.y}}get className(){return"attribute-field text-field"}get key(){return`edit-${this.attribute.id}`}get defaultValue(){return this.attribute.raw}onUp(){this.interactor.editPreviousAttribute(this.attribute)}onDown(){this.interactor.editNextAttribute(this.attribute)}commit(t){const e=g.fromRaw(t);if(t.trim().length){const s=new Ht(this.attribute,this.attribute.state,e);s.hasChanges()&&this.interactor.ui.history.pushAction(s)}else{const s=new Kt(this.attribute);this.interactor.ui.history.pushAction(s)}this.interactor.clearProxy(),this.interactor.editNextAttribute(this.attribute)}}class ae extends rt{constructor(t,e){super(t,e);this.entity=e}get position(){return{x:this.entity.left,y:this.entity.top+(this.entity.numAttributes()+1)*this.interactor.config.lineHeight}}get className(){return"attribute-field text-field"}get key(){return`new-attribute-${this.entity.id}-${new Date().getUTCMilliseconds()}`}get defaultValue(){return""}onUp(){this.interactor.editLastAttribute(this.entity)}onDown(){this.interactor.addNewAttribute(this.entity)}commit(t){const e=new Xt(this.entity,t);e.hasChanges()?(this.interactor.ui.history.pushAction(e),this.interactor.addNewAttribute(this.entity)):this.interactor.clearProxy()}}class le extends L{constructor(t,e){super(t);this.fromEntity=e,this.schema=this.interactor.ui.schema}onMouseMove(t){return this.position=this.interactor.eventRelativePosition(t),this.toEntity=this.schema.entityAt(this.position),!1}onMouseUp(t){if(!this.position||!this.toEntity)return!0;const e=new b(new I(this.fromEntity.id,"one"),new I(this.toEntity.id,"many")),s=new te(this.schema,e);return this.interactor.ui.history.pushAction(s),!0}renderOverlay(){if(this.position){const t={arity:"one"},e={arity:"many"},s=new et(this.interactor.config),o=this.config.gridSize*2,r=new O(this.position.x-o/2,this.position.y-o/2,o,o);s.addLine("new-association",this.fromEntity.id,this.fromEntity,"dangling",r);const a=s.layout();if(a.length)return i.exports.createElement("svg",null,i.exports.createElement(tt,{config:this.interactor.config,ui:this.interactor.ui,fromSide:t,toSide:e,path:a[0]}))}return i.exports.createElement("div",null)}}class ce{constructor(t,e){this.ui=t,this.config=e,document.addEventListener("keydown",s=>{s.target.tagName!="INPUT"&&((s.metaKey||s.ctrlKey)&&this.onCommandKey(s.key,s.shiftKey)&&s.preventDefault(),s.key=="Backspace"&&(this.ui.selection.numEntites()?(this.ui.selection.deleteEntities(),s.stopPropagation()):this.ui.selection.numAssociations()&&(this.ui.selection.deleteAssociations(),s.stopPropagation())))}),document.addEventListener("keypress",s=>{})}onCommandKey(t,e){switch(t){case"a":return this.ui.selection.selectAll(),!0;case"z":return e?this.ui.history.redo():this.ui.history.undo(),!0}return!1}}class he{constructor(t,e){this.type=t,this.component=e}}class f{constructor(t,e){this.config=t,this.schema=e,this.nextRenderType=f.RenderType.None,this.renderListeners=[],this.selection=new ee(this),this.interactor=new ie(this,t),this.history=new Wt(this,t),this.keymap=new ce(this,t)}requestRender(t){this.nextRenderType==f.RenderType.None&&requestAnimationFrame(this.onAnimationFrame.bind(this)),t>this.nextRenderType&&(this.nextRenderType=t)}listenForRender(t,e){this.renderListeners.push(new he(t,e))}onAnimationFrame(){for(let t of this.renderListeners)t.type<=this.nextRenderType&&t.component.forceUpdate();this.nextRenderType=f.RenderType.None,this.interactor.afterRender()}}(n=>{(t=>{t[t.None=0]="None",t[t.Overlay=1]="Overlay",t[t.Viewport=2]="Viewport",t[t.App=3]="App"})(n.RenderType||(n.RenderType={}))})(f||(f={}));var u=f;class pe extends i.exports.Component{constructor(t){super(t);this.props.ui.listenForRender(u.RenderType.Overlay,this)}render(){const t=this.props.ui;return i.exports.createElement("div",{className:"overlay-plane"},t.selection.renderOverlay(),t.interactor.render())}}class ue extends i.exports.Component{constructor(t){super(t)}componentDidMount(){this.props.ui.listenForRender(u.RenderType.Viewport,this)}render(){const{config:t,schema:e,ui:s}=this.props;return i.exports.createElement("div",{id:"viewport"},i.exports.createElement("div",{className:`canvas grid-${t.gridSize}`,onMouseDown:this.onMouseDown.bind(this),onMouseMove:this.onMouseMove.bind(this),onMouseUp:this.onMouseUp.bind(this),onDoubleClick:this.onDoubleClicked.bind(this)},i.exports.createElement("div",{className:"document-plane",key:`document-${e.id}`},i.exports.createElement(Vt,{config:t,ui:s,schema:e})),i.exports.createElement(pe,{key:`overlay-${e.id}`,config:t,ui:s})))}onMouseDown(t){this.props.ui.interactor.onCanvasMouseDown(t)}onMouseMove(t){this.props.ui.interactor.onCanvasMouseMove(t)}onMouseUp(t){this.props.ui.interactor.onCanvasMouseUp(t)}onDoubleClicked(t){this.props.ui.interactor.onCanvasDoubleClicked(t)}}class q extends v{constructor(t=null){super("schema",new de,t);this.entities={},this.associations={}}registerEntity(t){this.entities[t.id]=t}getEntity(t){return this.entities[t]}hasEntity(t){return!!this.entities[t]}addEntity(t){this.entities[t.id]=t}removeEntity(t){delete this.entities[t]}newEntity(t,e=null){return new Gt(this,t,e)}get allEntities(){return Object.entries(this.entities).map(t=>t[1])}filterEntities(t){return Object.entries(this.entities).filter(e=>t(e[1])).map(e=>e[1])}mapEntities(t){return Object.entries(this.entities).map(e=>t(e[1]))}entityAt(t){for(let e of this.allEntities)if(Dt(e,t))return e}registerAssociation(t){this.associations[t.id]=t}getAssociation(t){return this.associations[t]}addAssociation(t){this.associations[t.id]=t}removeAssociation(t){delete this.associations[t]}newAssociation(t,e=null){return new st(this,t,null)}buildAssociation(){return new Qt(this)}get allAssociations(){return Object.entries(this.associations).map(t=>t[1])}filterAssociations(t){return Object.entries(this.associations).filter(e=>t(e[1])).map(e=>e[1])}mapAssociations(t){return Object.entries(this.associations).map(e=>t(e[1]))}demo(t){const e=this.newEntity({name:"Foo",x:75,y:60,color:"blue"});e.newAttributeFromRaw("first name*"),e.newAttributeFromRaw("last name"),e.newAttributeFromRaw("created at : datetime"),e.newAttributeFromRaw("address"),e.snapPosition(t);const s=this.newEntity({name:"Bar",x:500,y:60,color:"cyan"});s.newAttributeFromRaw("time : datetime"),s.newAttributeFromRaw("number* : integer"),s.newAttributeFromRaw("description"),s.snapPosition(t);const o=this.newEntity({name:"Baz",x:75,y:400,color:"green"});o.newAttributeFromRaw("name*"),o.newAttributeFromRaw("width: integer"),o.newAttributeFromRaw("height: integer"),o.snapPosition(t),this.buildAssociation().add(e,"one").add(s,"many").build(),this.buildAssociation().add(e,"one").add(o,"many").build()}}class de{}function me(n){return n.filter((t,e)=>n.indexOf(t)===e)}class B extends i.exports.Component{constructor(t){super(t);this.selection=t.ui.selection}render(){let t=null;return this.selection.numEntites()?t=i.exports.createElement(xe,p({},this.props)):this.selection.numAssociations()&&(t=i.exports.createElement(fe,p({},this.props))),i.exports.createElement("div",{id:"selection-menu",className:t?"show":""},t)}}class xe extends B{constructor(t){super(t);this.state={showColorMenu:!1}}colorsToStripes(t){const s=(this.props.config.gridSize*2-4)/t.length,o=[];let r=0;for(let a of t){const l=this.props.config.color(a);o.push(`${l} ${r}px`),r+=s,o.push(`${l} ${r}px`)}return`repeating-linear-gradient(45deg, ${o.join(", ")})`}render(){var o;const t=this.props.config,e=me(this.selection.mapEntities(r=>r.state.color)).sort();let s={background:`${t.color(e[0])}`};return e.length>1&&(s.background=this.colorsToStripes(e)),i.exports.createElement("div",{className:"content"},i.exports.createElement("a",{className:"action color"},i.exports.createElement("div",{className:"color-circle",style:s,onClick:this.toggleColorMenu.bind(this)})),i.exports.createElement("a",{className:"action alert",title:"Delete Entity(s)",onClick:this.delete.bind(this)},i.exports.createElement(m.Delete,null)),((o=this.state)==null?void 0:o.showColorMenu)&&i.exports.createElement(ye,{config:this.props.config,onSelect:r=>this.changeColor(r)}))}toggleColorMenu(){var t;this.setState({showColorMenu:!((t=this.state)!=null&&t.showColorMenu)})}changeColor(t){this.setState({showColorMenu:!1});const e=this.selection.allEntities;let s=!1;for(let r of e)if(r.state.color!=t){s=!0;break}if(!s)return;const o=e.map(r=>{const a=w(p({},r.state),{color:t});return new T(r,r.state,a)});this.selection.ui.history.pushActions(o)}delete(){this.selection.deleteEntities()}}class ye extends i.exports.Component{render(){const t=this.props.config,e=Object.entries(t.colors).map(s=>{const o={background:s[1]};return i.exports.createElement("a",{className:"action color",key:s[0],onClick:()=>this.props.onSelect(s[0])},i.exports.createElement("div",{className:"color-circle",style:o}))});return i.exports.createElement("div",{className:"color-menu"},e)}}class fe extends B{render(){const t=this.selection.allAssociations[0],e=t.sides;t.state.isRequired;const s=t.entities,o=e[0].arity=="many"?s[1].state.name:s[0].state.name,r=e[0].arity=="many"?s[0].state.name:s[1].state.name;return i.exports.createElement("div",{className:"content"},i.exports.createElement("div",{className:"header"},i.exports.createElement("div",{className:"one-name"},o),i.exports.createElement("div",{className:"arity"},"Has Many"),i.exports.createElement("div",{className:"many-name"},r)),i.exports.createElement("a",{className:"action swap",title:"Swap Sides",onClick:()=>this.swapSides(t)},i.exports.createElement(m.SwapVertical,null)),i.exports.createElement("a",{className:"action requirement",title:t.state.isRequired?"Required":"Optional",onClick:()=>this.toggleRequired(t)},t.state.isRequired?"1":"0",":Many"),i.exports.createElement("a",{className:"action alert",title:"Delete Association",onClick:this.delete.bind(this)},i.exports.createElement(m.Delete,null)))}swapSides(t){const e=t.sides,s=w(p({},e[0]),{arity:H(e[0].arity)}),o=w(p({},e[1]),{arity:H(e[1].arity)}),r=new b(s,o),a=new X(t,t.state,r);this.selection.ui.history.pushAction(a)}toggleRequired(t){const e=new b(t.sides[0],t.sides[1],!t.state.isRequired),s=new X(t,t.state,e);this.selection.ui.history.pushAction(s)}delete(){this.selection.deleteAssociations()}}class G{constructor(t){this.schema=t}dump(t){const e=t.cloneNode(!0);console.log("view node",e);const s=Pt(this.schema.allEntities.map(r=>({x:r.left,y:r.top})));let o=$t(this.schema.allEntities.map(r=>({x:r.right,y:r.bottom})));console.log(`document goes from ${s.x},${s.y} to ${o.x},${o.y}`),o=Q(o,s),e.setAttribute("width",`${o.x}px`),e.setAttribute("height",`${o.y}px`),e.setAttribute("viewport",`0 0 ${o.x} ${o.y}`),e.querySelectorAll("g.icon-container").forEach(r=>{r.remove()});for(let r of Array.from(e.getElementsByClassName("plane-background")))r.setAttribute("fill","#ffffff");return e.outerHTML}download(t){}}class ge{constructor(t){this.config=t}warn(t){console.log(`WARN [Reader]: ${t}`)}read(t,e){const s=document.createElement("html");s.innerHTML=t;const o=e.length?e:null,r=new q(o);return s.querySelectorAll("g.entity").forEach(a=>{this.parseEntity(r,a)}),s.querySelectorAll("g.association").forEach(a=>{this.parseAssociation(r,a)}),s.remove(),r}parseEntity(t,e){var d,x;const s=e.id,o=e.querySelector("rect.entity-name-bar");let r={x:0,y:0};o&&(r.x=parseInt(o.getAttribute("x")||"0"),r.y=parseInt(o.getAttribute("y")||"0"));let a="";const l=e.querySelector("text.entity-name");l!=null&&l.textContent&&(a=l.textContent);let c="blue";if((x=(d=e.dataset)==null?void 0:d.color)!=null&&x.length)try{c=e.dataset.color}catch{this.warn(`invalid color name ${e.dataset.color}`)}const h=t.newEntity({name:a,x:r.x,y:r.y,color:c},s);e.querySelectorAll("g.attribute").forEach(N=>{this.parseAttribute(h,N)})}parseAttribute(t,e){const s=e.id;let o="";const r=e.querySelector("text.attribute-name");r!=null&&r.textContent&&(o=r.textContent);let a="";const l=e.querySelector("text.attribute-type");l!=null&&l.textContent&&(a=l.textContent);let c=(e==null?void 0:e.classList.contains("required"))||!1;t.newAttribute({name:o,type:a,isRequired:c},s)}parseAssociation(t,e){var c,h,d,x;const s=e.id,o={entityId:((c=e.dataset)==null?void 0:c.fromId)||"",arity:((h=e.dataset)==null?void 0:h.fromArity)||"one"};if(!t.hasEntity(o.entityId)){this.warn(`No entity ${o.entityId}`);return}const r={entityId:((d=e.dataset)==null?void 0:d.toId)||"",arity:((x=e.dataset)==null?void 0:x.toArity)||"one"};if(!t.hasEntity(r.entityId)){this.warn(`No entity ${r.entityId}`);return}let a=!0;e.classList.contains("optional")&&(a=!1);const l=new b(o,r,a);t.newAssociation(l,s)}}const Ce="1.1.1";var Y="/DBoard/assets/demo.1ae715f3.png";function ot(n,t="secondary"){var s;const e=document.createElement("div");e.classList.add("toast"),e.classList.add(t),e.innerHTML=n,(s=document.getElementById("toasts"))==null||s.appendChild(e),we(e,"show"),setTimeout(()=>{e.classList.remove("show"),Ee(e)},2e3)}function we(n,t){setTimeout(()=>{n.classList.add(t)},10)}function Ee(n,t=1e3){setTimeout(()=>{n.remove()},t)}const J="manifest";class R{constructor(){this.items={};const t=localStorage.getItem(J);if(t&&t.length)try{this.items=JSON.parse(t)}catch(e){console.log(`Error parsing raw manifest "${t}"`,e)}}addItem(t){const e=w(p({},t),{raw:void 0});this.items[t.id]?console.log("Replacing local manifest item",e):console.log("Adding local manifest item",e),this.items[t.id]=e}removeItem(t){delete this.items[t.id]}getItem(t){return this.items[t]}write(){localStorage.setItem(J,JSON.stringify(this.items))}get itemsInOrder(){return Object.entries(this.items).map(t=>t[1]).sort((t,e)=>(e.updatedAt||0)-(t.updatedAt||0))}loadItem(t){const e=localStorage.getItem(t.id);if(e)try{return JSON.parse(e)}catch(s){console.log("error parsing raw localstorage item",s,e)}return null}}class at{constructor(t){this.meta=t}static existingById(t){const s=new R().getItem(t);if(s)switch(s.origin){case"localStorage":return new C(s);default:throw`Unknown origin '${s.origin}'`}else return new C("")}save(t){const e=new G(t),s=document.getElementById("document"),o=e.dump(s);this.saveRaw(t.id,o)}export(t){const e=new G(t),s=document.getElementById("document"),o=e.dump(s);this.exportRaw(o),ot(`Downloaded '${this.nameWithExtension}'`)}exportRaw(t){const e=document.createElement("a"),s=new Blob([t],{type:"image/svg+xml"});e.href=URL.createObjectURL(s),e.download=this.nameWithExtension,e.click(),e.remove()}get fileName(){const t=this.meta.name.split("/");return t[t.length-1]}set fileName(t){this.meta.name=t}get nameWithExtension(){return this.fileName.indexOf(".svg")>0?this.fileName:this.fileName+".svg"}get nameWithoutExtension(){return this.fileName.replace(/\.svg/i,"")}async load(t){const e=await this.loadRaw();return console.log("raw: ",e),new ge(t).read(e,this.meta.id)}}class C extends at{constructor(t){t.id?super(t):super({id:"",name:t,origin:"localStorage",raw:void 0,updatedAt:0})}saveRaw(t,e){const s={id:t,name:this.nameWithoutExtension,raw:e,updatedAt:new Date().valueOf(),origin:"localStorage"};localStorage.setItem(t,JSON.stringify(s));const o=new R;o.addItem(s),o.write(),ot(`Saved '${this.nameWithExtension}' to local storage`)}async loadRaw(){return new Promise((t,e)=>{if(this.meta.id.length){const s=new R().loadItem(this.meta);if(s&&s.raw){t(s.raw);return}}t("<svg></svg>")})}renderButton(){return i.exports.createElement("div",null,i.exports.createElement(m.BlankDocument,null),i.exports.createElement("h2",null,"Blank"),i.exports.createElement("p",null,"Create a new blank document"))}}class be extends C{constructor(){super({id:"",raw:void 0,name:"",origin:"localStorage",updatedAt:0})}async loadRaw(){const t=document.createElement("input");return t.setAttribute("type","file"),t.setAttribute("accept",".svg"),new Promise((e,s)=>{t.addEventListener("change",()=>{const o=t.files;if(console.log(`selected ${o==null?void 0:o.length} files`),!o)alert("You must select an SVG file to upload!");else if(o.length==1){const r=o[0];this.meta.name=r.name,r.text().then(a=>{e(a)})}else alert("You must select only one SVG file to upload!");t.remove()},!1),t.click()})}renderButton(){return i.exports.createElement("div",null,i.exports.createElement(m.Upload,null),i.exports.createElement("h2",null,"Upload"),i.exports.createElement("p",null,"Upload an SVG file that was previously generated with DBoard"))}}class ve extends C{constructor(){super({id:"demo",raw:void 0,name:"demo",origin:"localStorage",updatedAt:0})}async loadRaw(){return new Promise((t,e)=>{t(Y)})}async load(t){const e=new q;return e.demo(t),new Promise(s=>{s(e)})}renderButton(){return i.exports.createElement("div",null,i.exports.createElement("img",{src:Y}),i.exports.createElement("h2",null,"Demo"),i.exports.createElement("p",null,"A demo document with existing entities and associations"))}}class Le extends i.exports.Component{constructor(t){super(t);this.state={items:this.props.manifest.itemsInOrder}}dataUri(t){const e=t.replace(/\%09/g,"").replace(/\%0A/g,"");return`data:image/svg+xml;base64,${btoa(e)}`}render(){const t=this.state.items.map(e=>{const s=new Date(e.updatedAt||0),o=this.props.manifest.loadItem(e),r=o&&o.raw?this.dataUri(o.raw):"";return i.exports.createElement("a",{key:e.id,className:"item",onClick:()=>this.onItemClicked(e)},i.exports.createElement("div",{className:"name"},e.name),o&&o.raw&&i.exports.createElement("img",{className:"preview",src:r}),i.exports.createElement("div",{className:"updated-at"},s.toDateString()),i.exports.createElement("div",{className:"close",onClick:a=>{this.onRemoveItem(e),a.stopPropagation()}},i.exports.createElement(m.Close,null)))});return i.exports.createElement("div",{className:"manifest"},t)}onItemClicked(t){this.props.onSourceSelected(new C(t))}onRemoveItem(t){const e=this.props.manifest;confirm("Remove this document from the recent list?")&&(e.removeItem(t),e.write(),this.setState({items:e.itemsInOrder}))}}class Fe extends i.exports.Component{constructor(t){super(t);this.sources=[new C("untitled"),new be,new ve]}render(){const t=this.props.onPicked,e=this.sources.map((s,o)=>i.exports.createElement("a",{className:"source",key:`source-${o}`,onClick:()=>t(s)},s.renderButton()));return i.exports.createElement("div",{className:"source-picker-bg"},i.exports.createElement("div",{className:"source-picker"},i.exports.createElement("div",{className:"banner"},i.exports.createElement(_,null),i.exports.createElement("div",{className:"tagline"},"Open Source Data Modeler"),i.exports.createElement("div",{className:"version"},"Version ",Ce)),i.exports.createElement("a",{className:"close",onClick:()=>this.props.onCanceled()},i.exports.createElement(m.Close,null)),i.exports.createElement("div",{className:"sources"},e),i.exports.createElement(Le,{manifest:new R,onSourceSelected:s=>t(s)}),i.exports.createElement("div",{className:"footer"},i.exports.createElement("div",{className:"column"},i.exports.createElement("a",{href:"https://github.com/Terrier-Tech/DBoard",target:"_blank"},i.exports.createElement(m.Github,null),i.exports.createElement("span",null,"Source Code"))),i.exports.createElement("div",{className:"column"},i.exports.createElement("a",{href:"http://terrier.tech",target:"_blank"},i.exports.createElement(m.Terrier,null),i.exports.createElement("span",null,"\xA9 ",new Date().getFullYear()," Terrier Technologies"))))))}}class Se extends i.exports.Component{constructor(t){super(t);this.config=new xt;const e=new q,s=new u(this.config,e);s.listenForRender(u.RenderType.App,this);const o=location.hash;let r=new C("untitled");if(console.log(`hash: ${o}`),o.length>1){const a=o.substring(1);r=at.existingById(a),this.reload(r)}this.state={ui:s,schema:e,source:r,pickSource:!0}}async reload(t){const e=await t.load(this.config),s=new u(this.config,e);s.listenForRender(u.RenderType.App,this),history.pushState(null,"",`#${e.id}`),this.setState({ui:s,schema:e,source:t,pickSource:!1})}open(){this.setState({pickSource:!0})}render(){const{schema:t,ui:e,source:s,pickSource:o}=this.state,r=o?"with-modal":"";return i.exports.createElement("div",{id:`app-${t.id}`,className:r},i.exports.createElement(ue,{key:`viewport-${t.id}`,config:this.config,ui:e,schema:t}),i.exports.createElement(Nt,{key:`topbar-${t.id}`,config:this.config,ui:e,schema:t,source:s,onOpen:this.open.bind(this)}),i.exports.createElement(B,{key:`menu-${t.id}`,config:this.config,ui:e,schema:t}),o&&i.exports.createElement(Fe,{onPicked:a=>this.reload(a),onCanceled:()=>this.setState({pickSource:!1})}),i.exports.createElement("div",{id:"toasts"}))}}var ke=document.getElementById("app");dt.exports.render(i.exports.createElement(Se,null),ke);
