var nt=Object.defineProperty,ot=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var W=(n,t,e)=>t in n?nt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,p=(n,t)=>{for(var e in t||(t={}))at.call(t,e)&&W(n,e,t[e]);if(V)for(var e of V(t))lt.call(t,e)&&W(n,e,t[e]);return n},E=(n,t)=>ot(n,rt(t));import{r as i,a as ct}from"./vendor.b71a34ef.js";const ht=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}};ht();class pt{constructor(){this.fontSize=15,this.lineHeight=32,this.padding=12,this.iconSize=48,this.minEntitySize=8*this.gridSize,this.fontFamily="Verdana, Geneva, sans-serif",this.colors={blue:"#2980b9",green:"#27ae60",purple:"#8e44ad",cyan:"#079992",gray:"#bdc3c7",orange:"#f39c12",red:"#c0392b",yellow:"#f1c40f"},this.fgColor="#333333",this.oddBgColor="#f8f8f8",this.evenBgColor="#ffffff",this.hintFgColor="#aaa",this.hintBgColor="#eee",this.utilCanvas=document.createElement("canvas"),this.utilContext=this.utilCanvas.getContext("2d")}get gridSize(){return this.lineHeight/2}measureText(t,e="normal"){return this.utilContext.font=`${e} ${this.fontSize}px sans-serif`,this.utilContext.measureText(t)}snapNearest(t){return Math.round(t/this.gridSize)*this.gridSize}snapUp(t){return Math.ceil(t/this.gridSize)*this.gridSize}snapUpEven(t){return Math.ceil(t/(2*this.gridSize))*this.gridSize*2}color(t){return this.colors[t]}}const J=n=>i.exports.createElement("svg",p({width:"160px",height:"48px",viewBox:"0 0 160 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"logo-white"),i.exports.createElement("g",{id:"logo-white",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("g",{id:"board",transform:"translate(12.000000, 8.000000)",fill:"#FFFFFF"},i.exports.createElement("path",{d:"M32,4 L32,24 L0,24 L0,4 L32,4 Z M30,8 L2,8 L2,22 L30,22 L30,8 Z",id:"Rectangle-2"}),i.exports.createElement("rect",{id:"Rectangle",x:15,y:0,width:2,height:4}),i.exports.createElement("rect",{id:"Rectangle-Copy-2",x:15,y:24,width:2,height:8}),i.exports.createElement("polygon",{id:"Path-2",points:"14 24 6 32 9 32 15 26 15 24"}),i.exports.createElement("polygon",{id:"Path-2-Copy",transform:"translate(21.000000, 28.000000) scale(-1, 1) translate(-21.000000, -28.000000) ",points:"24 24 17 32 20 32 25 26 25 24"})),i.exports.createElement("path",{d:"M62.812,32 C65.5493469,32 67.7242601,31.1195842 69.196,29.768 C70.6099708,28.4694684 71.62,26.5291843 71.62,23.96 C71.62,22.7919922 71.4119922,21.7119922 70.996,20.72 C69.7751531,17.8087183 66.9131285,15.92 62.812,15.92 L56.452,15.92 L56.452,32 L62.812,32 Z M62.668,28.568 L60.412,28.568 L60.412,19.352 L62.668,19.352 C65.5524377,19.352 67.636,21.1147395 67.636,23.96 C67.636,26.8055059 65.5528314,28.568 62.668,28.568 Z M82.2039766,31.9999766 C85.3108644,31.9999766 87.5079766,30.444608 87.5079766,27.4879766 C87.5079766,26.9119766 87.3999766,26.3479766 87.1839766,25.7959766 C86.7915651,24.7931475 85.6503785,23.8951766 84.4119766,23.7919766 L84.412,23.696 C84.844,23.648 85.2920078,23.4519922 85.756,23.108 C86.5406168,22.5263047 87.0519766,21.550892 87.0519766,20.312 C87.0519766,17.5799507 84.9806571,15.9199766 82.1799766,15.9199766 L73.8519766,15.9199766 L73.8519766,31.9999766 L82.2039766,31.9999766 Z M81.2679531,22.5679766 L77.8119531,22.5679766 L77.8119531,19.1119766 L81.4119766,19.1119766 C82.4025504,19.1119766 83.2119531,19.7893536 83.2119531,20.7679766 C83.2119531,21.8549316 82.3752073,22.5679766 81.2679531,22.5679766 Z M81.5079531,28.8079766 L77.8119531,28.8079766 L77.8119531,25.2799766 L81.5799531,25.2799766 C82.6546654,25.2799766 83.4759531,25.9528829 83.4759531,27.0079531 C83.4759531,28.1519067 82.6889072,28.8079766 81.5079531,28.8079766 Z M95.62,32.3360469 C96.5000078,32.3360469 97.3400078,32.1840547 98.14,31.8800469 C100.387882,31.0258214 102.22,29.0283539 102.22,25.9760234 C102.22,25.0640234 102.023992,24.1680312 101.632,23.2880234 C100.699899,21.1954927 98.469863,19.64 95.62,19.64 C93.6279692,19.64 92.0029639,20.3906921 90.904,21.4040234 C89.800197,22.421817 88.948,23.9681335 88.948,25.9760469 C88.948,28.0957043 89.961079,29.88458 91.264,30.8720469 C92.4800631,31.7936852 93.8078975,32.3360469 95.62,32.3360469 Z M95.62,29.0960234 C93.9337385,29.0960234 92.6440469,27.7445839 92.6440469,25.9760234 C92.6440469,24.2322804 93.8996765,22.8560234 95.6200469,22.8560234 C97.2402736,22.8560234 98.5240469,24.2998397 98.5240469,25.9760234 C98.5240469,27.6977297 97.2632006,29.0960234 95.62,29.0960234 Z M107.86,32.3599766 C109.283992,32.3599766 110.483992,31.9439844 111.46,31.1119766 L111.46,31.9999766 L115.156,31.9999766 L115.156,24.3679766 C115.156,23.6159844 115.028008,22.9399766 114.772,22.3399766 C114.004845,20.5420112 112.194876,19.592 109.636,19.592 C108.563992,19.592 107.644,19.772 106.876,20.132 C105.479254,20.7867247 104.468741,21.7967411 104.116,23.384 L108.014523,23.384 C108.34307,22.8480078 108.923565,22.616 109.756,22.616 C110.742359,22.616 111.46,23.3089982 111.46,24.296 L111.46,24.536 L108.388,24.536 C105.573875,24.536 103.372,25.7856084 103.372,28.4239766 C103.372,30.9000206 105.317244,32.3599766 107.86,32.3599766 Z M108.939977,29.4799766 C108.068168,29.4799766 107.259977,29.052262 107.259977,28.2319766 C107.259977,27.4304598 107.979856,26.9839766 108.819977,26.9839766 L111.459977,26.9839766 L111.459977,27.2479766 C111.459977,27.7279766 111.327977,28.1359766 111.063977,28.4719766 C110.606938,29.053662 109.898823,29.4799766 108.939977,29.4799766 Z M121.396,32.0000234 L121.396,28.2320234 C121.396,25.2240312 122.780008,23.7200234 125.548,23.7200234 L126.244,23.7200234 L126.412,19.8800234 C126.155992,19.8160156 125.867992,19.784 125.548,19.784 C123.515889,19.784 122.21633,20.9278514 121.396,22.2560234 L121.396,19.9520234 L117.556,19.9520234 L117.556,32.0000234 L121.396,32.0000234 Z M132.964,32.3600469 C134.483992,32.3600469 135.731992,31.9200547 136.708,31.0400469 L136.708,32.0000469 L140.548,32.0000469 L140.548,14.72 L136.708,14.72 L136.708,20.912 C135.731992,20.0319922 134.483992,19.592 132.964,19.592 C131.27304,19.592 129.798466,20.3766132 128.931977,21.272 C127.854089,22.385835 127.084,23.9215208 127.084,25.9760234 C127.084,27.9269474 127.840011,29.5532594 128.824,30.5960234 C129.755772,31.5834523 131.179121,32.3600469 132.964,32.3600469 Z M133.756,29.0960469 C131.974698,29.0960469 130.852,27.7135588 130.852,25.9760234 C130.852,24.2539583 131.99038,22.8560234 133.756,22.8560234 C135.416739,22.8560234 136.707977,24.2731624 136.707977,25.9760234 C136.707977,27.7201331 135.423635,29.0960469 133.756,29.0960469 Z",id:"DBoard",fill:"#FFFFFF",fillRule:"nonzero"}))),ut=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-blank-document"),i.exports.createElement("g",{id:"icon-blank-document",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("g",{id:"stroke-copy",transform:"translate(12.000000, 8.000000)",fill:"#FFFFFF",fillRule:"nonzero"},i.exports.createElement("path",{d:"M16,0 L24,8 L24,32 L0,32 L0,0 L16,0 Z M15.171,2 L2,2 L2,30 L22,30 L22,8.829 L15.171,2 Z",id:"Path-12"}),i.exports.createElement("polygon",{id:"Path-13",points:"16 1 16 8 23 8 23 10 14 10 14 1"})))),dt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-close"),i.exports.createElement("g",{id:"icon-close",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("rect",{id:"Rectangle",fill:"#FFFFFF",transform:"translate(24.500000, 24.000000) rotate(45.000000) translate(-24.500000, -24.000000) ",x:8,y:22,width:33,height:4}),i.exports.createElement("rect",{id:"Rectangle-Copy",fill:"#FFFFFF",transform:"translate(24.000000, 24.000000) rotate(45.000000) translate(-24.000000, -24.000000) ",x:22,y:8,width:4,height:32}))),mt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-delete"),i.exports.createElement("g",{id:"icon-delete",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("path",{d:"M10,15 L10,13 C10,12.4477153 10.4477153,12 11,12 L37,12 C37.5522847,12 38,12.4477153 38,13 L38,15 L38,15 L10,15 Z",id:"Path-3",fill:"#FFFFFF"}),i.exports.createElement("path",{d:"M36,15 L36,41 L12,41 L12,15 L36,15 Z M26,17 L22,17 L22,39 L26,39 L26,17 Z M34,17 L30,17 L30,39 L34,39 L34,17 Z M18,17 L14,17 L14,39 L18,39 L18,17 Z",id:"Path-6",fill:"#FFFFFF"}),i.exports.createElement("path",{d:"M26,9 C27.6568542,9 29,10.3431458 29,12 C29,13.6568542 27.6568542,15 26,15 L22,15 C20.3431458,15 19,13.6568542 19,12 C19,10.3431458 20.3431458,9 22,9 L26,9 Z M26,11 L22,11 C21.4477153,11 21,11.4477153 21,12 L21,12 L21,13 C21,13.5522847 21.4477153,14 22,14 L22,14 L26,14 C26.5522847,14 27,13.5522847 27,13 L27,13 L27,12 C27,11.4477153 26.5522847,11 26,11 L26,11 Z",id:"Rectangle-2",fill:"#FFFFFF"}))),xt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-download"),i.exports.createElement("g",{id:"icon-download",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("polygon",{id:"Path-10",fill:"#FFFFFF",points:"24 30 16 22 21 22 21 12 27 12 27 22 32 22"}),i.exports.createElement("polygon",{id:"Path-9",fill:"#FFFFFF",points:"10 28 10 36 38 36 38 28 34 28 34 32.2077207 14 32.2077207 14 28"}))),yt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-github"),i.exports.createElement("g",{id:"icon-github",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("path",{d:"M24,8 C32.836556,8 40,15.163444 40,24 C40,31.2946359 35.1183904,37.4491109 28.4437619,39.374834 C28.1343281,39.141899 27.9342384,38.8247689 27.9342384,38.4349788 L27.9342384,32.3428882 L27.9342384,32.3428882 L27.5025506,31.165503 C30.9142123,30.3979495 33.2136782,28.8632404 34.4009483,26.5613755 C36.1818534,23.1085783 34.6312024,18.8807796 33.190018,18.1280103 C33.7573762,16.0771787 33.6214349,14.3678419 32.7821942,13 C30.8976086,13 29.2816233,13.683921 27.9342384,15.0517629 C25.0076038,14.0098453 23.0155743,14.0098453 19.8499292,15.0517629 C18.5697955,13.683921 16.9826744,13 15.0885658,13 C14.3756295,14.3678419 14.2683267,16.0771787 14.7666574,18.1280103 C13.3439356,19.5837799 12.2116421,23.4581301 13.5842147,26.6985617 C14.4992631,28.8588494 16.8403346,30.3478298 20.6074292,31.165503 L20.2664011,33.4200611 C19.0679546,33.6591944 17.9730244,33.5691471 16.9816106,33.1499192 C15.4944898,32.5210773 14.8133808,30.7120647 13.792427,30.4154397 C13.1117911,30.2176898 12.5143155,30.2176898 12,30.4154397 C12.8997769,31.3378462 13.4972525,31.980329 13.792427,32.3428882 C14.2351888,32.8867271 14.7257577,34.8172735 16.4884849,35.5769272 C17.6636364,36.083363 18.9229418,36.2243873 20.2664011,36 L20.2664011,38.4349788 C20.196369,38.8665434 20.0397455,39.2023402 19.7965307,39.4423691 C12.9985755,37.5955407 8,31.3815103 8,24 C8,15.163444 15.163444,8 24,8 Z",id:"Oval-2",fill:"#FFFFFF"}))),gt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-open"),i.exports.createElement("g",{id:"icon-open",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd",strokeLinejoin:"round"},i.exports.createElement("polyline",{id:"Path-11",stroke:"#FFFFFF",strokeWidth:2,points:"33 18 33 15 19 15 17 13 11 13 9 15 9 35 33 35 40 18 17 18 9 35"}))),ft=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-plus-entity"),i.exports.createElement("g",{id:"icon-plus-entity",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("path",{d:"M40,8 L40,38 L8,38 L8,8 L40,8 Z M38,16 L10,16 L10,36 L38,36 L38,16 Z",id:"Rectangle-2",fill:"#FFFFFF"}),i.exports.createElement("rect",{id:"Rectangle",fill:"#FFFFFF",x:23,y:20,width:2,height:12}),i.exports.createElement("rect",{id:"Rectangle-Copy-2",fill:"#FFFFFF",x:18,y:25,width:12,height:2}))),wt=n=>i.exports.createElement("svg",p({width:"48px",height:"32px",viewBox:"0 0 48 32",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-plus-attribute"),i.exports.createElement("g",{id:"icon-plus-attribute",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("g",{id:"plus",transform:"translate(2.000000, 10.000000)",fill:"#FFFFFF"},i.exports.createElement("rect",{id:"Rectangle",x:5,y:0,width:2,height:12}),i.exports.createElement("rect",{id:"Rectangle-Copy-2",x:0,y:5,width:12,height:2})),i.exports.createElement("rect",{id:"Rectangle",fill:"#FFFFFF",x:16,y:8,width:24,height:2}),i.exports.createElement("rect",{id:"Rectangle-Copy",fill:"#FFFFFF",x:20,y:15,width:24,height:2}),i.exports.createElement("rect",{id:"Rectangle-Copy-3",fill:"#FFFFFF",x:16,y:22,width:24,height:2}))),Et=n=>i.exports.createElement("svg",p({width:"48px",height:"32px",viewBox:"0 0 48 32",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-plus-association"),i.exports.createElement("g",{id:"icon-plus-association",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("g",{id:"plus",transform:"translate(2.000000, 10.000000)",fill:"#FFFFFF"},i.exports.createElement("rect",{id:"Rectangle",x:5,y:0,width:2,height:12}),i.exports.createElement("rect",{id:"Rectangle-Copy-2",x:0,y:5,width:12,height:2})),i.exports.createElement("rect",{id:"Rectangle-Copy",fill:"#FFFFFF",x:18,y:15,width:26,height:2}),i.exports.createElement("polygon",{id:"Path-7",fill:"#FFFFFF",points:"33 15 44 4 44 6.98279228 36 15"}),i.exports.createElement("polygon",{id:"Path-7-Copy",fill:"#FFFFFF",transform:"translate(38.500000, 22.500000) scale(1, -1) translate(-38.500000, -22.500000) ",points:"33 28 44 17 44 19.9397241 36.0378746 28"}))),Ct=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-undo"),i.exports.createElement("g",{id:"icon-undo",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("polygon",{id:"Path-5",fill:"#FFFFFF",points:"14 20 14 14 20 20"}),i.exports.createElement("path",{d:"M24,34 C29.5228475,34 34,29.5228475 34,24 C34,18.4771525 29.5228475,14 24,14 C18.4771525,14 14,18.4771525 14,24",id:"Oval",stroke:"#FFFFFF",strokeWidth:4,transform:"translate(24.000000, 24.000000) rotate(45.000000) translate(-24.000000, -24.000000) "}))),bt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-upload"),i.exports.createElement("g",{id:"icon-upload",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("polygon",{id:"Path-10",fill:"#FFFFFF",transform:"translate(24.000000, 21.000000) scale(1, -1) translate(-24.000000, -21.000000) ",points:"24 30 16 22 21 22 21 12 27 12 27 22 32 22"}),i.exports.createElement("polygon",{id:"Path-9",fill:"#FFFFFF",points:"10 28 10 36 38 36 38 28 34 28 34 32.2077207 14 32.2077207 14 28"}))),vt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-redo"),i.exports.createElement("g",{id:"icon-redo",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("polygon",{id:"Path-5",fill:"#FFFFFF",transform:"translate(31.000000, 17.000000) scale(-1, 1) translate(-31.000000, -17.000000) ",points:"28 20 28 14 34 20"}),i.exports.createElement("path",{d:"M24,34 C29.5228475,34 34,29.5228475 34,24 C34,18.4771525 29.5228475,14 24,14 C18.4771525,14 14,18.4771525 14,24",id:"Oval",stroke:"#FFFFFF",strokeWidth:4,transform:"translate(24.000000, 24.000000) scale(-1, 1) rotate(45.000000) translate(-24.000000, -24.000000) "}))),Ft=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-save"),i.exports.createElement("g",{id:"icon-save",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("polygon",{id:"Path-15",stroke:"#FFFFFF",strokeWidth:2,strokeLinejoin:"round",points:"13 13 13 35 35 35 35 14.6514216 33.3243239 13"}),i.exports.createElement("rect",{id:"Rectangle",stroke:"#FFFFFF",strokeWidth:2,strokeLinejoin:"round",x:17,y:25,width:14,height:10}),i.exports.createElement("path",{d:"M29,13 C29.5522847,13 30,13.4477153 30,14 L30,19 C30,19.5522847 29.5522847,20 29,20 L19,20 C18.4477153,20 18,19.5522847 18,19 L18,14 C18,13.4477153 18.4477153,13 19,13 L29,13 Z M28,14 L27,14 C26.4477153,14 26,14.4477153 26,15 L26,15 L26,18 C26,18.5522847 26.4477153,19 27,19 L27,19 L28,19 C28.5522847,19 29,18.5522847 29,18 L29,18 L29,15 C29,14.4477153 28.5522847,14 28,14 L28,14 Z",id:"Rectangle-Copy-3",fill:"#FFFFFF"}))),kt=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-swap-vertical"),i.exports.createElement("g",{id:"icon-swap-vertical",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("polygon",{id:"Path-8",fill:"#FFFFFF",points:"20 10 20 38 16 38 16 22 12 22"}),i.exports.createElement("polygon",{id:"Path-8-Copy",fill:"#FFFFFF",transform:"translate(32.000000, 24.000000) rotate(180.000000) translate(-32.000000, -24.000000) ",points:"36 10 36 38 32 38 32 22 28 22"}))),At=n=>i.exports.createElement("svg",p({width:"48px",height:"48px",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n),i.exports.createElement("title",null,"icon-terrier"),i.exports.createElement("g",{id:"icon-terrier",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},i.exports.createElement("text",{id:"Type-something",fontFamily:"MollenPersonalUse-Bold, Mollen Personal Use",fontSize:24,fontWeight:"bold"}),i.exports.createElement("path",{d:"M9.94996541,35 C9.81680405,34.8144231 9.89088057,34.4320513 10.1161966,34 C10.0143414,34.4169872 9.94996541,34.7798077 9.94996541,34.9823718 L9.94996541,35 Z M40.5773523,18.4374291 L40.5764704,18.4369985 C40.4794655,18.328045 40.3498316,18.2104786 40.1818366,18.0825767 C38.8131848,17.0442889 38.283185,16.3759261 38.283185,15.413432 C38.283185,15.1205926 38.1160719,14.7037272 37.8144746,14.2717891 C37.4052901,13.6835265 36.7434517,13.0685638 35.9127365,12.700792 C36.2019876,12.3605816 36.4903569,11.9859194 36.6799575,11.6508767 C37.1954066,10.7383376 37.1195664,9.40290392 36.2840009,10.2934801 C35.5564637,11.0682125 33.8870965,11.785669 33.3751749,12.4970964 C32.5316727,12.7150033 31.929801,13.1818237 31.5819059,13.8002316 C31.0488196,14.3501667 30.1330046,15.2950043 29.3578467,16.0964368 C28.1849686,17.3087056 27.9931633,18.460684 26.8930389,18.2823965 C25.7924735,18.1036784 21.7601537,18.5916004 18.8993892,18.4912599 C16.4019524,18.4029774 13.624524,18.8284558 12.276155,19.5588317 C12.276155,19.5588317 12.2426442,19.552372 12.1875278,19.5394526 C11.8801984,19.4623669 10.8585598,19.1462727 10.3237097,18.2823965 C10.1058895,17.9365877 9.96964163,17.5020657 9.9872789,16.9585903 C10.0617963,14.8092355 13.2528186,14.5814237 13.985647,15.3807029 C14.7184754,16.182566 14.2784256,14.2760956 12.592744,14.0396708 C10.9048576,13.8053993 8.85187993,14.2437971 8.92463365,17.3194718 C8.93742066,17.9318506 9.07410947,18.4585308 9.28707945,18.9055415 C9.32720423,18.9895175 9.3712974,19.0730628 9.41759522,19.1505791 C9.89688791,19.9912004 10.6495582,20.5152967 11.2968459,20.7818667 C11.2236512,21.0118317 11.1663301,21.2676355 11.1292918,21.5385119 C11.0556563,22.041076 11.0477195,22.5966095 11.1200323,23.1340558 C10.3457563,24.8049628 10.6751323,28.268219 10.3660392,29.3917748 C9.98022399,30.7883602 9.70552358,30.6272985 9.21079828,31.0570834 C8.71519112,31.4868682 8,34.817916 8,35.7313165 C8,36.6451476 8.05511645,37 9.21079828,37 C9.65305271,37 9.88454183,36.8682223 9.97537374,36.6795993 C10.1521873,36.7506559 10.4004318,36.7838156 10.7505316,36.7838156 C11.9057725,36.7838156 11.631072,35.8928088 11.1359058,35.4091932 C10.6407396,34.9255776 11.6857476,32.3468685 13.1655142,31.5945298 C14.6448398,30.842191 15.811104,29.6062366 16.5822934,27.8866666 C17.0461535,26.8531158 17.668308,26.2674371 18.0920434,25.9629703 C20.3081658,26.1619288 22.4912183,26.4741472 23.667183,26.9241724 C24.6725071,27.310462 26.1703519,27.4676479 27.6007342,27.2239022 C27.4913831,27.9861458 27.3815911,28.7604476 27.3815911,29.1097016 C27.3815911,29.8103628 27.6567325,33.8149412 27.6567325,35.0160133 C27.6567325,36.2196692 27.7118489,36.9694241 28.3719236,36.9694241 C28.9204425,36.9694241 29.4883625,37.1003405 29.6770812,36.7739108 C29.9407584,36.7437656 30.1228631,36.6326588 30.1321227,36.3036452 C30.1506418,35.6533695 29.5271645,35.4027335 29.472048,34.8019821 C29.4173725,34.2012308 30.0774472,28.3935371 30.3521476,27.7927857 C30.6272889,27.192465 31.4923968,24.7881676 31.4923968,24.7881676 C31.5633868,24.5952382 31.5854334,24.4195345 31.5770557,24.257181 C32.5986943,22.2107505 33.3496009,20.2073847 34.3439017,19.3740845 C34.4854408,19.4167184 34.6318301,19.4571992 34.7888017,19.4925121 C37.4467377,20.0855119 38.7386674,20.6806648 39.5746737,20.0855119 C39.8846487,19.8658823 40.2365121,19.6759674 40.4860794,19.4718411 C40.8273605,19.5446203 41.024457,19.1019161 40.9975601,18.8336236 C40.9697814,18.5649004 40.5773523,18.4374291 40.5773523,18.4374291 L40.5773523,18.4374291 Z",id:"Fill-5",fill:"#FFFFFF"}))),d={BlankDocument:ut,Close:dt,Delete:mt,Download:xt,Github:yt,Open:gt,PlusEntity:ft,PlusAttribute:wt,PlusAssociation:Et,Undo:Ct,Upload:bt,Redo:vt,Save:Ft,SwapVertical:kt,Terrier:At};class St extends i.exports.Component{constructor(t){super(t);this.state={fileName:this.props.source.fileName}}componentDidMount(){this.setState({fileName:this.props.source.fileName})}render(){const t=this.props.ui.history;return i.exports.createElement("div",{id:"topbar"},i.exports.createElement("a",{className:"logo",onClick:()=>this.props.onOpen()},i.exports.createElement(J,null)),i.exports.createElement("div",{className:"spacer"}),i.exports.createElement("a",{className:"action",title:"Open",onClick:()=>this.props.onOpen()},i.exports.createElement(d.Open,null)),i.exports.createElement("div",{className:"text-field"},i.exports.createElement("input",{type:"text",className:"file-name",onChange:this.onFileNameChanged.bind(this),value:this.state.fileName})),i.exports.createElement("a",{className:"action",title:"Save",onClick:this.save.bind(this)},i.exports.createElement(d.Save,null)),i.exports.createElement("a",{className:"action",title:"Download",onClick:this.download.bind(this)},i.exports.createElement(d.Download,null)),i.exports.createElement("div",{className:"spacer"}),i.exports.createElement("a",{className:`action ${t.canUndo()?"":"inactive"}`,onClick:()=>t.undo()},i.exports.createElement(d.Undo,null)),i.exports.createElement("a",{className:`action ${t.canRedo()?"":"inactive"}`,onClick:()=>t.redo()},i.exports.createElement(d.Redo,null)),i.exports.createElement("a",{className:"action",onMouseDown:this.startNewEntity.bind(this),onClick:()=>alert("Drag this icon onto the canvas to add a new entity")},i.exports.createElement(d.PlusEntity,null)))}startNewEntity(t){this.props.ui.interactor.beginNewEntity()}save(){this.props.source.save(this.props.schema)}download(){this.props.source.export(this.props.schema)}onFileNameChanged(t){this.props.source.fileName=t.currentTarget.value,this.setState({fileName:this.props.source.fileName})}}class b{constructor(t,e){this.x=t,this.y=e}}function Q(n,t){return{x:n.x+t.x,y:n.y+t.y}}function A(n,t){return{x:n.x-t.x,y:n.y-t.y}}function S(n){return{x:Math.round(n.x),y:Math.round(n.y)}}function Rt(n){if(!n.length)return{x:0,y:0};let t=n[0];for(let e of n)t={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)};return t}function Mt(n){if(!n.length)return{x:0,y:0};let t=n[0];for(let e of n)t={x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)};return t}function P(n,t){return n.x*t.y-n.y*t.x}function R(n,t){const e=n[0],s=t[0],r=A(n[1],n[0]),o=A(t[1],t[0]),a=P(r,o);if(a==0)return null;const l=P(A(s,e),o)/a,c=P(A(s,e),r)/a;return c>=0&&c<=1&&l>=0&&l<=1?{x:s.x+c*o.x,y:s.y+c*o.y}:null}class z{constructor(t,e,s,r){this.x=t,this.y=e,this.width=s,this.height=r}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}isWithin(t){return this.x>=t.x&&this.y>=t.y&&this.right<=t.right&&this.bottom<=t.bottom}}function j(n){return{x:(n.left+n.right)/2,y:(n.top+n.bottom)/2}}function D(n){if(!n.length)throw"Must provide at least one point for the rectangle!";let t=null,e=null,s=null,r=null;for(let o of n)t=t?Math.min(t,o.x):o.x,e=e?Math.min(e,o.y):o.y,s=s?Math.max(s,o.x):o.x,r=r?Math.max(r,o.y):o.y;return new z(t,e,s-t,r-e)}function Nt(n,t){return t.x>=n.left&&t.x<=n.right&&t.y>=n.top&&t.y<=n.bottom}function Lt(n){return{ne:{x:n.right,y:n.top},nw:{x:n.left,y:n.top},se:{x:n.right,y:n.bottom},sw:{x:n.left,y:n.bottom}}}class Pt extends i.exports.Component{constructor(t){super(t)}render(){const t=this.props.config,e=this.props.attribute,s=this.props.width,r=e.state,o=this.props.x,a=this.props.y;this.props.attribute.position=new b(o,a);const l=a+t.lineHeight/2+1,c=r.isRequired?"required":"",h=this.props.index%2==0?t.evenBgColor:t.oddBgColor;return i.exports.createElement("g",{className:`attribute ${c}`,id:e.id,onClick:this.onClicked.bind(this),onDoubleClick:this.onDoubleClicked.bind(this)},i.exports.createElement("rect",{x:o,y:a,width:s,height:t.lineHeight,stroke:"transparent",fill:h}),i.exports.createElement("text",{className:"attribute-name",x:o+t.padding,y:l},r.name),i.exports.createElement("text",{className:"attribute-type",x:o+s-t.padding,y:l},r.type))}onClicked(t){t.stopPropagation(),this.props.ui.interactor.onAttributeClicked(this.props.attribute,t)}onDoubleClicked(t){t.stopPropagation(),this.props.ui.interactor.onAttributeDoubleClicked(this.props.attribute,t)}}class $t extends i.exports.Component{constructor(t){super(t)}render(){const t=this.props.config,e=this.props.entity,s=e.width/2,r=e.left,o=this.props.y,a=this.props.config.iconSize,l={transform:`translate(${r+s/2-a/2}px,${o}px)`};return i.exports.createElement("g",{className:"new-button",id:`${e.id}-new-attribute`,onMouseDown:this.onClicked.bind(this)},i.exports.createElement("rect",{x:r,y:o,width:s,height:t.lineHeight,stroke:"transparent"}),i.exports.createElement("g",{className:"icon-container",style:l},i.exports.createElement(d.PlusAttribute,null)))}onClicked(t){t.stopPropagation(),this.props.ui.interactor.onNewAttributeClicked(this.props.entity)}}class Dt extends i.exports.Component{constructor(t){super(t)}render(){const t=this.props.config,e=this.props.entity,s=e.width/2,r=e.left+s,o=this.props.y,a=this.props.config.iconSize,l={transform:`translate(${r+s/2-a/2}px,${o}px)`};return i.exports.createElement("g",{className:"new-button",id:`${e.id}-new-attribute`,onMouseDown:this.onMouseDown.bind(this),onClick:this.onClicked.bind(this)},i.exports.createElement("rect",{x:r,y:o,width:s,height:t.lineHeight,stroke:"transparent"}),i.exports.createElement("g",{className:"icon-container",style:l},i.exports.createElement(d.PlusAssociation,null)))}onMouseDown(t){t.stopPropagation(),this.props.ui.interactor.onNewAssociationPressed(this.props.entity)}onClicked(t){t.stopPropagation(),alert("Drag this button to create a new association")}}class It extends i.exports.Component{constructor(t){super(t)}render(){const t=this.props.config,e=this.props.entity,[s,r]=e.size,o=e.state,a=t.lineHeight,l=t.color(o.color);let c=0,h=o.y;const m=o.y+t.lineHeight/2+1,x=e.mapAttributes(k=>(h+=a,c+=1,i.exports.createElement(Pt,{key:k.id,config:t,ui:this.props.ui,width:s,x:o.x,y:h,index:c,attribute:k})));return h+=a,h=Math.max(h,o.y+r-t.lineHeight),i.exports.createElement("g",{className:"entity",id:e.id,"data-color":e.state.color,onClick:this.onClicked.bind(this),onDoubleClick:this.onDoubleClicked.bind(this),onMouseDown:this.onMouseDown.bind(this)},i.exports.createElement("rect",{className:"entity-background",x:o.x,y:o.y,width:s,height:r,stroke:"transparent",fill:"#ffffff"}),i.exports.createElement("rect",{className:"entity-name-bar",x:o.x,y:o.y,width:s,height:a,stroke:"transparent",fill:l}),i.exports.createElement("text",{className:"entity-name",x:o.x+s/2,y:m},o.name),x,i.exports.createElement($t,{config:t,ui:this.props.ui,y:h,entity:e}),i.exports.createElement(Dt,{config:t,ui:this.props.ui,y:h,entity:e}),i.exports.createElement("line",{className:"top-highlight",x1:e.left,y1:e.top+.5,x2:e.right,y2:e.top+.5}),i.exports.createElement("line",{className:"bottom-highlight",x1:e.left,y1:e.bottom-.5,x2:e.right,y2:e.bottom-.5}),i.exports.createElement("line",{className:"side-highlight",x1:e.left+.5,y1:e.top+.5,x2:e.left+.5,y2:e.bottom-.5}),i.exports.createElement("line",{className:"side-highlight",x1:e.right-.5,y1:e.top+.5,x2:e.right-.5,y2:e.bottom-.5}))}onClicked(t){this.props.ui.interactor.onEntityClicked(this.props.entity,t)}onMouseDown(t){t.stopPropagation(),this.props.ui.interactor.onEntityMouseDown(this.props.entity,t)}onDoubleClicked(t){this.props.ui.interactor.onEntityDoubleClicked(this.props.entity,t)}}class _ extends i.exports.Component{render(){var a;const t=this.props.path,e=this.props.fromSide,s=this.props.toSide;let r=!1,o={fromId:"",fromArity:"",toId:"",toArity:""};if(this.props.association){r=this.props.ui.selection.isAssociationSelected(this.props.association);const l=this.props.association.sides;o={fromId:l[0].entityId,fromArity:l[0].arity,toId:l[1].entityId,toArity:l[1].arity}}return i.exports.createElement("g",{className:`association ${r?"selected":""}`,id:(a=this.props.association)==null?void 0:a.id,"data-from-id":o.fromId,"data-from-arity":o.fromArity,"data-to-id":o.toId,"data-to-arity":o.toArity,onMouseDown:this.onClicked.bind(this)},i.exports.createElement("polyline",{className:"main invisible",points:t.svgPoints}),i.exports.createElement("polyline",{className:"main line",points:t.svgPoints}),e.arity=="many"&&this.renderChickenFoot(t.firstPoint,t.fromDir),s.arity=="many"&&this.renderChickenFoot(t.lastPoint,t.toDir))}renderChickenFoot(t,e){const s=this.props.config.gridSize;let r=[];switch(e){case"n":r=[{x:t.x-s+1,y:t.y+1},{x:t.x,y:t.y-s},{x:t.x+s-1,y:t.y+1}];break;case"s":r=[{x:t.x-s+1,y:t.y-1},{x:t.x,y:t.y+s},{x:t.x+s-1,y:t.y-1}];break;case"e":r=[{x:t.x-1,y:t.y-s+1},{x:t.x+s,y:t.y},{x:t.x-1,y:t.y+s-1}];break;case"w":r=[{x:t.x+1,y:t.y-s+1},{x:t.x-s,y:t.y},{x:t.x+1,y:t.y+s-1}];break}const o=r.map(a=>`${a.x},${a.y}`).join(" ");return i.exports.createElement("polyline",{className:"foot line",key:e,points:o})}onClicked(t){this.props.association&&(t.stopPropagation(),this.props.ui.interactor.onAssociationClicked(this.props.association))}}const Ot=["n","s","e","w"];function Z(n,t){return t=="s"||t=="n"?n.x:n.y}function zt(n,t,e){return t=="s"||t=="n"?{x:e,y:n.y}:{x:n.x,y:e}}function Tt(n,t){return t=="s"||t=="n"?[n.left,n.right]:[n.top,n.bottom]}class Bt{constructor(t,e,s){this.id=t,this.fromId=e,this.toId=s,this.points=[],this.fromDir="e",this.toDir="e"}get svgPoints(){return this.points.map(t=>`${t.x},${t.y}`).join(" ")}get firstPoint(){return this.points[0]}get lastPoint(){return this.points[this.points.length-1]}get bounds(){return D(this.points)}}class tt{constructor(t){this.config=t,this.rects={},this.lines=[]}addLine(t,e,s,r,o){this.rects[e]=s,this.rects[r]=o,this.lines.push(new Bt(t,e,r))}findEdge(t,e,s,r){const o=Lt(s);let a=null;const l=this.config.gridSize;return(a=R(t,[o.nw,o.ne]))?(a={x:Math.min(Math.max(a.x,s.left+l),s.right-l),y:a.y},e.points[r]=S(a),"n"):(a=R(t,[o.ne,o.se]))?(a={x:a.x,y:Math.min(Math.max(a.y,s.top+l),s.bottom-l)},e.points[r]=S(a),"e"):(a=R(t,[o.se,o.sw]))?(a={x:Math.min(Math.max(a.x,s.left+l),s.right-l),y:a.y},e.points[r]=S(a),"s"):(a=R(t,[o.sw,o.nw]))?(a={x:a.x,y:Math.min(Math.max(a.y,s.top+l),s.bottom-l)},e.points[r]=S(a),"w"):null}squareOut(t,e,s){const r=this.config.gridSize,o=t.points,a=[t.fromDir,t.toDir].sort().join(""),l=(o[0].x+o[1].x)/2,c=(o[0].y+o[1].y)/2;switch(a){case"ew":c>=e.top+r&&c>=s.top+r&&c<=e.bottom-r&&c<=s.bottom-r?(t.points[0]={x:o[0].x,y:c},t.points[1]={x:o[1].x,y:c}):t.points=[o[0],{x:l,y:o[0].y},{x:l,y:o[1].y},o[1]];return;case"ns":l>=e.left+r&&l>=s.left+r&&l<=e.right-r&&l<=s.right-r?(t.points[0]={x:l,y:o[0].y},t.points[1]={x:l,y:o[1].y}):t.points=[o[0],{x:o[0].x,y:c},{x:o[1].x,y:c},o[1]];return;case"en":t.points=[o[0],{x:Math.max(o[0].x,o[1].x),y:Math.min(o[0].y,o[1].y)},o[1]];return;case"nw":t.points=[o[0],{x:Math.min(o[0].x,o[1].x),y:Math.min(o[0].y,o[1].y)},o[1]];return;case"es":t.points=[o[0],{x:Math.max(o[0].x,o[1].x),y:Math.max(o[0].y,o[1].y)},o[1]];return;case"sw":t.points=[o[0],{x:Math.min(o[0].x,o[1].x),y:Math.max(o[0].y,o[1].y)},o[1]];return;default:throw`Don't know how to square out directions '${a}'`}}spreadSides(t,e,s,r){const o=Tt(s,r),a=this.config.gridSize,l=[];for(let c of t)c.fromId==e&&c.fromDir==r&&l.push({index:0,v:Z(c.firstPoint,r),line:c}),c.toId==e&&c.toDir==r&&l.push({index:c.points.length-1,v:Z(c.lastPoint,r),line:c});if(l.length>1){l.sort((h,m)=>h.v-m.v);let c=o[1]-o[0];for(let h=0;h<l.length-1;h++)c=Math.min(c,l[h+1].v-l[h].v);if(c<a){const h=(o[1]-o[0])/l.length;for(let m in l){const x=l[m];x.line.points[x.index]=zt(x.line.points[x.index],r,o[0]+(parseInt(m)+.5)*h)}}}}layout(){let t=[];for(let e of this.lines){const s=this.rects[e.fromId],r=this.rects[e.toId];e.points=[j(s),j(r)];const o=[e.points[0],e.points[1]];let a=null,l=!0;if((a=this.findEdge(o,e,s,0))?e.fromDir=a:l=!1,(a=this.findEdge(o,e,r,1))?e.toDir=a:l=!1,!l)continue;const c=e.bounds;(c.width>this.config.gridSize||c.height>this.config.gridSize)&&t.push(e)}Object.entries(this.rects).forEach(e=>{for(let s of Ot)this.spreadSides(t,e[0],e[1],s)});for(let e of t){const s=this.rects[e.fromId],r=this.rects[e.toId];this.squareOut(e,s,r)}return t}}class qt extends i.exports.Component{constructor(t){super(t)}render(){const t=this.props.config,e=this.props.schema,s=e.mapEntities(c=>(c.computeSize(t),i.exports.createElement(It,{key:c.id,config:this.props.config,ui:this.props.ui,entity:c}))),r=new tt(t);e.mapAssociations(c=>{const h=c.entities;r.addLine(c.id,h[0].id,h[0],h[1].id,h[1])});const a=r.layout().map(c=>{const h=e.getAssociation(c.id),m=h.sides;return h.linePath=c,i.exports.createElement(_,{key:h.id,config:this.props.config,ui:this.props.ui,path:c,fromSide:m[0],toSide:m[1],association:h})}),l=`
		.entity-name {
			font: bold ${t.fontSize}px ${t.fontFamily};
			fill: #ffffff;
			text-anchor: middle;
			dominant-baseline: middle;
		}
		.top-highlight {
			stroke: rgba(255, 255, 255, 0.3);
			stroke-width: 1px;
		}
		.bottom-highlight {
			stroke: rgba(0, 0, 0, 0.1);
			stroke-width: 1px;
		}
		.side-highlight {
			stroke: rgba(128, 128, 128, 0.1);
			stroke-width: 1px;
		}
		.attribute-name {
			font: ${t.fontSize}px ${t.fontFamily};
			fill: ${t.fgColor};
			text-anchor: start;
			dominant-baseline: middle;
		}
		.attribute-type {
			font: ${t.fontSize}px ${t.fontFamily};
			fill: ${t.hintFgColor};
			text-anchor: end;
			dominant-baseline: middle;
		}
		.attribute.required .attribute-name {
			font: bold ${t.fontSize}px ${t.fontFamily};
		}
		.new-button rect {
			fill: ${t.hintBgColor};
		}
		.new-button svg g {
			fill: ${t.hintFgColor};
		}
		.association polyline.line {
			stroke: ${t.fgColor};
			fill: none;
			stroke-width: 2px;
		}
		.association polyline.invisible {
			stroke-width: ${t.lineHeight};
			fill: none;
			stroke: transparent;
		}
		`;return i.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"3000",height:"3000",id:"document"},i.exports.createElement("style",null,l),i.exports.createElement("g",{id:"associations"},a),i.exports.createElement("g",{id:"entities"},s))}}const I=class{constructor(n,t,e){this.state=t,e?(this.id=e,I.bumpCount(n,e)):this.id=I.getId(n)}static newGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,e=n=="x"?t:t&3|8;return e.toString(16)})}static getId(n){return n=="schema"?this.newGuid():(this.idCounts[n]?this.idCounts[n]+=1:this.idCounts[n]=1,`${n}-${this.idCounts[n]}`)}static bumpCount(n,t){const e=t.split("-");if(e.length>1){const s=parseInt(e[1]);this.idCounts[n]?this.idCounts[n]=Math.max(this.idCounts[n],s):this.idCounts[n]=s+1}}};let v=I;v.idCounts={};class Ut{constructor(t,e){this.ui=t,this.config=e,this.actionSets=[],this.index=-1}numActions(){return this.actionSets.length}pushAction(t){this.pushSet(new Set([t]))}pushActions(t){this.pushSet(new Set(t))}pushSet(t){this.index>=this.numActions()&&(this.actionSets=this.actionSets.slice(0,this.index)),this.actionSets.push(t),this.index=this.actionSets.length-1,this.applySet(t),console.log(`action history at ${this.index}`)}applySet(t){t.forEach(e=>{e.apply(this.config,this.ui)}),this.ui.requestRender(u.RenderType.App)}unapplySet(t){t.forEach(e=>{e.unapply(this.config,this.ui)}),this.ui.requestRender(u.RenderType.App)}canUndo(){return this.index>-1}undo(){if(console.log("undo"),this.index<0)return!1;const t=this.actionSets[this.index];return this.unapplySet(t),this.ui.requestRender(u.RenderType.App),this.index-=1,console.log(`action history at ${this.index}`),!0}canRedo(){return this.index<this.numActions()-1}redo(){if(console.log("redo"),this.index>=this.numActions()-1)return!1;this.index+=1;const t=this.actionSets[this.index];return this.applySet(t),console.log(`action history at ${this.index}`),!0}}class y{}class M extends v{constructor(t,e,s=null){super("attribute",e,s);this.entity=t,this.position=new b(0,0),t.registerAttribute(this)}static fromRaw(t,e){const s=f.fromRaw(e);return new M(t,s)}get raw(){return f.toRaw(this.state)}}class f{constructor(t,e="text",s=!1){this.name=t,this.type=e,this.isRequired=s}static fromRaw(t){const e=t.split(":");let s=e[0].trim(),r="text";e.length>1&&(r=e[1].trim());let o=!1;return s.indexOf("*")>-1&&(o=!0,s=s.replace(/\*/g,"")),new f(s,r,o)}static toRaw(t){const e=t.isRequired?"*":"";return`${t.name}${e}: ${t.type}`}}class Vt extends y{constructor(t,e,s){super();this.attribute=t,this.fromState=e,this.toState=s}apply(){this.attribute.state=this.toState}unapply(){this.attribute.state=this.fromState}hasChanges(){return f.toRaw(this.fromState)!=f.toRaw(this.toState)}}class Wt extends y{constructor(t,e){super();this.entity=t,this.raw=e}apply(){this.attribute=this.entity.newAttributeFromRaw(this.raw)}unapply(){this.attribute&&this.entity.removeAttribute(this.attribute.id)}hasChanges(){return this.raw.length>0}}class jt extends y{constructor(t){super();this.attribute=t,this.entity=t.entity}apply(){this.entity.removeAttribute(this.attribute.id)}unapply(){this.attribute=this.entity.newAttributeFromRaw(this.attribute.raw)}hasChanges(){return!0}}const et=["left","right","horizontalCenter","top","bottom","verticalCenter"];class Zt extends v{constructor(t,e=new Ht,s=null){super("entity",e,s);this.schema=t,this.attributes={},this.size=[0,0],t.registerEntity(this)}computeSize(t){let e=t.measureText(this.state.name,"bold").width+2*t.padding;this.mapAttributes(r=>{let o=t.measureText(r.state.name,"bold").width+t.measureText(r.state.type).width+4*t.padding;e=Math.max(e,o)});const s=(this.numAttributes()+2)*t.lineHeight;return this.size=[Math.max(t.minEntitySize,t.snapUpEven(e)),Math.max(t.minEntitySize,t.snapUpEven(s))]}get width(){return this.size[0]}get height(){return this.size[1]}moveTo(t,e){this.state.x=t,this.state.y=e}get left(){return this.state.x}get right(){return this.state.x+this.size[0]}get horizontalCenter(){return this.state.x+this.size[0]/2}get top(){return this.state.y}get bottom(){return this.state.y+this.size[1]}get verticalCenter(){return this.state.y+this.size[1]/2}getPosition(t){switch(t){case"left":return this.left;case"right":return this.right;case"horizontalCenter":return this.horizontalCenter;case"top":return this.top;case"bottom":return this.bottom;case"verticalCenter":return this.verticalCenter}}snapPosition(t){this.moveTo(t.snapNearest(this.state.x),t.snapNearest(this.state.y))}registerAttribute(t){this.attributes[t.id]=t}removeAttribute(t){delete this.attributes[t]}numAttributes(){return Object.entries(this.attributes).length}newAttribute(t,e=null){return new M(this,t,e)}newAttributeFromRaw(t){return M.fromRaw(this,t)}getAttribute(t){return this.attributes[t]}attributesInOrder(){return Object.entries(this.attributes).sort((e,s)=>e[1].state.name>s[1].state.name?1:-1).map(e=>e[1])}mapAttributes(t){return this.attributesInOrder().map(t)}firstAttribute(){return this.attributesInOrder()[0]}lastAttribute(){const t=this.attributesInOrder();return t[t.length-1]}previousAttribute(t){let e;return this.attributesInOrder().reverse().forEach(s=>{!e&&s.state.name<t.state.name&&(e=s)}),e}nextAttribute(t){let e;return this.attributesInOrder().forEach(s=>{!e&&s.state.name>t.state.name&&(e=s)}),e}isWithin(t){return new z(this.state.x,this.state.y,this.size[0],this.size[1]).isWithin(t)}}class Ht{constructor(){this.name="",this.x=0,this.y=0,this.color="blue"}}class Xt extends y{constructor(t,e){super();this.schema=t,this.state=e}apply(t,e){this.entity?this.schema.addEntity(this.entity):this.entity=this.schema.newEntity(this.state),e.selection.addEntity(this.entity),this.entity.state.name.length||e.interactor.editEntityName(this.entity)}unapply(t,e){this.entity&&this.schema.removeEntity(this.entity.id)}hasChanges(){return!0}}class T extends y{constructor(t,e,s){super();this.entity=t,this.fromState=e,this.toState=s}apply(t,e){this.entity.state=this.toState}unapply(t,e){this.entity.state=this.fromState}hasChanges(){return this.fromState.x!=this.toState.x||this.fromState.y!=this.toState.y||this.fromState.name!=this.toState.name}}class Kt extends y{constructor(t){super();this.entity=t,this.schema=t.schema}apply(t,e){this.schema.removeEntity(this.entity.id)}unapply(t,e){this.schema.addEntity(this.entity)}hasChanges(){return!0}}class it extends v{constructor(t,e,s=null){super("association",e,s);this.schema=t,this.linePath=null,t.registerAssociation(this)}get entities(){return Object.entries(this.state.sides).map(t=>this.schema.getEntity(t[0]))}get sides(){return Object.entries(this.state.sides).map(t=>t[1])}}function H(n){return n=="one"?"many":"one"}class O{constructor(t,e="one"){this.entityId=t,this.arity=e}}class L{constructor(t,e){this.sides={},this.sides[t.entityId]=t,this.sides[e.entityId]=e}}class Gt{constructor(t){this.schema=t,this.sides=[]}add(t,e="one"){return this.sides.push(new O(t.id,e)),this}build(){if(this.sides.length!=2)throw"Must call add() twice!";return new it(this.schema,new L(this.sides[0],this.sides[1]))}}class Yt extends y{constructor(t,e){super();this.schema=t,this.state=e}apply(t,e){this.association?this.schema.addAssociation(this.association):this.association=this.schema.newAssociation(this.state),e.selection.addAssociation(this.association,!1)}unapply(t,e){this.association&&this.schema.removeAssociation(this.association.id)}hasChanges(){return!0}}class Jt extends y{constructor(t,e,s){super();this.association=t,this.fromState=e,this.toState=s}apply(t,e){this.association.state=this.toState}unapply(t,e){this.association.state=this.fromState}hasChanges(){const{fromFirstSide:t,fromLastSide:e}=this.fromState.sides,{toFirstSide:s,toLastSide:r}=this.toState.sides;return t.arity!=s.arity||e.arity!=r.arity}}class X extends y{constructor(t){super();this.association=t,this.schema=t.schema}apply(t,e){this.schema.removeAssociation(this.association.id)}unapply(t,e){this.schema.addAssociation(this.association)}hasChanges(){return!0}}class Qt{constructor(t){this.ui=t,this.mode=0,this.entities={},this.associations={}}clear(){return this.entities={},this.associations={},this.ui.requestRender(u.RenderType.App),this}numEntites(){return Object.entries(this.entities).length}isEntitySelected(t){return this.entities[t.id]!=null}addEntity(t,e=!1){!e&&this.mode==0&&this.clear(),this.entities[t.id]=t,this.ui.requestRender(u.RenderType.App)}selectAll(){this.ui.schema.mapEntities(t=>{this.entities[t.id]=t}),this.ui.requestRender(u.RenderType.App)}get allEntities(){return Object.entries(this.entities).map(t=>t[1])}mapEntities(t){return Object.entries(this.entities).map(e=>t(e[1]))}deleteEntities(){const t=Object.keys(this.entities),e=this.mapEntities(s=>new Kt(s));for(let s of t)this.ui.schema.mapAssociations(r=>{for(let o of r.sides)o.entityId==s&&e.push(new X(r))});this.ui.history.pushActions(e),this.clear()}numAssociations(){return Object.entries(this.associations).length}isAssociationSelected(t){return this.associations[t.id]!=null}addAssociation(t,e=!1){!e&&this.mode==0&&(this.associations={}),this.associations[t.id]=t,this.ui.requestRender(u.RenderType.App)}mapAssociations(t){return Object.entries(this.associations).map(e=>t(e[1]))}get allAssociations(){return Object.entries(this.associations).map(t=>t[1])}deleteAssociations(){const t=this.mapAssociations(e=>new X(e));this.ui.history.pushActions(t),this.clear()}renderOverlay(){const t=this.mapEntities(e=>{const s=e.size,r={width:s[0]+2,height:s[1]+2,top:e.top-1,left:e.left-1};return i.exports.createElement("div",{className:"entity-overlay",key:e.id,style:r})});return i.exports.createElement("div",{className:"selection"},t)}}class _t{constructor(t,e){this.ui=t,this.config=e}onCanvasMouseDown(t){this.proxy||(this.proxy=new te(this,t))}onCanvasMouseMove(t){t.buttons&&this.proxy&&(this.proxy.onMouseMove(t),this.ui.requestRender(u.RenderType.Overlay))}onCanvasMouseUp(t){this.proxy&&this.proxy.onMouseUp(t)&&this.clearProxy()}onCanvasDoubleClicked(t){this.clearProxy(),this.ui.selection.clear()}onEntityMouseDown(t,e){this.proxy||(this.ui.selection.addEntity(t,e.shiftKey||this.ui.selection.isEntitySelected(t)),this.proxy=new ee(this,e))}onEntityClicked(t,e){}onEntityDoubleClicked(t,e){this.editEntityName(t),e.stopPropagation()}onAttributeClicked(t,e){}onAttributeDoubleClicked(t,e){this.editAttribute(t),e.stopPropagation()}editEntityName(t){this.clearProxy(),this.proxy=new $(this,t)}editAttribute(t){this.clearProxy(),this.proxy=new C(this,t)}editFirstAttribute(t){let e=t.firstAttribute();e?this.proxy=new C(this,e):this.addNewAttribute(t),this.ui.requestRender(u.RenderType.Viewport)}editLastAttribute(t){let e=t.lastAttribute();e?this.proxy=new C(this,e):this.proxy=new $(this,t),this.ui.requestRender(u.RenderType.Viewport)}editPreviousAttribute(t){let e=t.entity.previousAttribute(t);e?this.proxy=new C(this,e):this.proxy=new $(this,t.entity),this.ui.requestRender(u.RenderType.Viewport)}editNextAttribute(t){let e=t.entity.nextAttribute(t);e?this.proxy=new C(this,e):this.onNewAttributeClicked(t.entity),this.ui.requestRender(u.RenderType.Viewport)}addNewAttribute(t){this.proxy=new ne(this,t),this.ui.requestRender(u.RenderType.Viewport)}onNewAttributeClicked(t){this.addNewAttribute(t)}onNewAssociationPressed(t){this.clearProxy(),this.proxy=new oe(this,t)}onAssociationClicked(t){this.ui.selection.clear().addAssociation(t)}beginNewEntity(){this.proxy=new se(this,this.ui.schema),this.ui.requestRender(u.RenderType.Viewport)}render(){return this.proxy?this.proxy.renderOverlay():i.exports.createElement("div",{className:"select-interactor"})}afterRender(){this.proxy&&this.proxy.afterRender()}eventRelativePosition(t){const s=t.currentTarget.getBoundingClientRect();return new b(t.clientX-s.left,t.clientY-s.top)}clearProxy(){this.proxy&&(this.proxy=void 0,this.ui.requestRender(u.RenderType.App))}}class F{constructor(t){this.interactor=t,this.config=t.config}onMouseMove(t){return!1}onMouseUp(t){return!1}afterRender(){}}class te extends F{constructor(t,e){super(t);this.hasMoved=!1,this.selection=t.ui.selection,e.shiftKey||this.selection.clear(),this.initialPos=this.interactor.eventRelativePosition(e),this.range=D([this.initialPos])}updateRange(t){const e=this.interactor.eventRelativePosition(t);this.range=D([e,this.initialPos])}onMouseMove(t){return this.updateRange(t),this.hasMoved=!0,!1}onMouseUp(t){return this.updateRange(t),this.interactor.ui.schema.mapEntities(e=>{e.isWithin(this.range)&&this.selection.addEntity(e,!0)}),!0}renderOverlay(){if(!this.hasMoved)return i.exports.createElement("div",null);const t={left:this.range.x,top:this.range.y,width:this.range.width,height:this.range.height};return i.exports.createElement("div",{className:"select-interactor rubber-band",style:t})}}class ee extends F{constructor(t,e){super(t);this.initialStates={},this.guides=[],this.selection=t.ui.selection,this.selection.mapEntities(s=>{this.initialStates[s.id]=p({},s.state)}),this.diffPos=new b(0,0)}onMouseMove(t){return this.diffPos=Q(this.diffPos,{x:t.movementX,y:t.movementY}),this.selection.mapEntities(e=>{let s=this.initialStates[e.id];e.moveTo(s.x+this.diffPos.x,s.y+this.diffPos.y)}),this.computeGuides(),this.interactor.ui.requestRender(u.RenderType.Viewport),!1}onMouseUp(t){const e=this.selection.mapEntities(s=>(s.snapPosition(this.interactor.config),new T(s,this.initialStates[s.id],s.state)));return this.guides=[],e.map(s=>s.hasChanges()).includes(!0)?this.interactor.ui.history.pushActions(e):this.interactor.ui.requestRender(u.RenderType.Viewport),!0}renderOverlay(){return i.exports.createElement("div",{className:"select-interactor"},this.guides.map((t,e)=>i.exports.createElement(ie,E(p({},t),{key:`guide-${e}`}))))}computeGuides(){this.guides=[];const t=this.interactor.ui.schema.filterEntities(e=>!this.selection.isEntitySelected(e));for(let e of et){let s=this.selection.mapEntities(r=>this.interactor.config.snapNearest(r.getPosition(e)));s=[...new Set(s)],t.forEach(r=>{const o=r.getPosition(e);s.indexOf(o)>-1&&this.guides.push({positionType:e,xy:o})})}}}class ie extends i.exports.Component{render(){const t=this.props.positionType,e=et.indexOf(t)<3?"left":"top",s={};return s[e]=this.props.xy,i.exports.createElement("div",{className:`guide ${t}`,style:s})}}class se extends F{constructor(t,e){super(t);this.schema=e}onMouseMove(t){return this.position=this.interactor.eventRelativePosition(t),!1}onMouseUp(t){if(!this.position)return!0;const e={name:"",x:this.config.snapNearest(this.position.x-this.config.minEntitySize/2),y:this.config.snapNearest(this.position.y-this.config.minEntitySize/2),color:"blue"},s=new Xt(this.schema,e);return this.interactor.ui.history.pushAction(s),!1}renderOverlay(){if(!this.position)return i.exports.createElement("div",{id:"new-entity-proxy"});const t=this.interactor.config.iconSize,e={top:this.position.y-t/2,left:this.position.x-t/2};return i.exports.createElement("div",{id:"new-entity-proxy",style:e},i.exports.createElement(d.PlusEntity,null))}}class B extends F{constructor(t,e){super(t);this.entity=e,this.input=i.exports.createRef()}onKeyPress(t){switch(t.key){case"Enter":this.commit(t.currentTarget.value);return;case"Escape":this.interactor.clearProxy();return}}onKeyDown(t){switch(t.key){case"Escape":t.preventDefault(),this.interactor.clearProxy();return;case"ArrowUp":t.preventDefault(),this.onUp();return;case"ArrowDown":t.preventDefault(),this.onDown();return}}afterRender(){var t;(t=this.input.current)==null||t.focus()}renderOverlay(){const t=this.interactor.config,e=this.position,s={left:e.x,top:e.y,width:this.entity.width,height:t.lineHeight},r={width:"100%"};return i.exports.createElement("div",{className:this.className,key:this.key,style:s},i.exports.createElement("input",{type:"text",ref:this.input,defaultValue:this.defaultValue,placeholder:this.placeholder,style:r,onKeyPress:this.onKeyPress.bind(this),onKeyDown:this.onKeyDown.bind(this)}))}get placeholder(){return""}}class $ extends B{constructor(t,e){super(t,e);this.entity=e}get position(){return new b(this.entity.left,this.entity.top)}get className(){return"entity-name-field text-field"}get key(){return`edit-${this.entity.id}`}get defaultValue(){return this.entity.state.name}get placeholder(){return"Entity Name"}onUp(){this.interactor.addNewAttribute(this.entity)}onDown(){this.interactor.editFirstAttribute(this.entity)}commit(t){const e=p({},this.entity.state);if(e.name=t.trim(),e.name.length>0&&e.name!=this.entity.state.name){const s=new T(this.entity,this.entity.state,e);this.interactor.ui.history.pushAction(s)}this.interactor.clearProxy(),this.interactor.editFirstAttribute(this.entity)}}class C extends B{constructor(t,e){super(t,e.entity);this.attribute=e}get position(){return this.attribute.position}get className(){return"attribute-field text-field"}get key(){return`edit-${this.attribute.id}`}get defaultValue(){return this.attribute.raw}get placeholder(){return"name: type"}onUp(){this.interactor.editPreviousAttribute(this.attribute)}onDown(){this.interactor.editNextAttribute(this.attribute)}commit(t){const e=f.fromRaw(t);if(t.trim().length){const s=new Vt(this.attribute,this.attribute.state,e);s.hasChanges()&&this.interactor.ui.history.pushAction(s)}else{const s=new jt(this.attribute);this.interactor.ui.history.pushAction(s)}this.interactor.clearProxy(),this.interactor.editNextAttribute(this.attribute)}}class ne extends B{constructor(t,e){super(t,e);this.entity=e}get position(){return{x:this.entity.left,y:this.entity.top+(this.entity.numAttributes()+1)*this.interactor.config.lineHeight}}get className(){return"attribute-field text-field"}get key(){return`new-attribute-${this.entity.id}-${new Date().getUTCMilliseconds()}`}get defaultValue(){return""}get placeholder(){return"name: type"}onUp(){this.interactor.editLastAttribute(this.entity)}onDown(){this.interactor.addNewAttribute(this.entity)}commit(t){const e=new Wt(this.entity,t);e.hasChanges()?(this.interactor.ui.history.pushAction(e),this.interactor.addNewAttribute(this.entity)):this.interactor.clearProxy()}}class oe extends F{constructor(t,e){super(t);this.fromEntity=e,this.schema=this.interactor.ui.schema}onMouseMove(t){return this.position=this.interactor.eventRelativePosition(t),this.toEntity=this.schema.entityAt(this.position),!1}onMouseUp(t){if(!this.position||!this.toEntity)return!0;const e=new L(new O(this.fromEntity.id,"one"),new O(this.toEntity.id,"many")),s=new Yt(this.schema,e);return this.interactor.ui.history.pushAction(s),!0}renderOverlay(){if(this.position){const t={arity:"one"},e={arity:"many"},s=new tt(this.interactor.config),r=this.config.gridSize*2,o=new z(this.position.x-r/2,this.position.y-r/2,r,r);s.addLine("new-association",this.fromEntity.id,this.fromEntity,"dangling",o);const a=s.layout();if(a.length)return i.exports.createElement("svg",null,i.exports.createElement(_,{config:this.interactor.config,ui:this.interactor.ui,fromSide:t,toSide:e,path:a[0]}))}return i.exports.createElement("div",null)}}class re{constructor(t,e){this.ui=t,this.config=e,document.addEventListener("keydown",s=>{s.target.tagName!="INPUT"&&((s.metaKey||s.ctrlKey)&&this.onCommandKey(s.key,s.shiftKey)&&s.preventDefault(),s.key=="Backspace"&&(this.ui.selection.numEntites()?(this.ui.selection.deleteEntities(),s.stopPropagation()):this.ui.selection.numAssociations()&&(this.ui.selection.deleteAssociations(),s.stopPropagation())))}),document.addEventListener("keypress",s=>{})}onCommandKey(t,e){switch(t){case"a":return this.ui.selection.selectAll(),!0;case"z":return e?this.ui.history.redo():this.ui.history.undo(),!0}return!1}}class ae{constructor(t,e){this.type=t,this.component=e}}class g{constructor(t,e){this.config=t,this.schema=e,this.nextRenderType=g.RenderType.None,this.renderListeners=[],this.selection=new Qt(this),this.interactor=new _t(this,t),this.history=new Ut(this,t),this.keymap=new re(this,t)}requestRender(t){this.nextRenderType==g.RenderType.None&&requestAnimationFrame(this.onAnimationFrame.bind(this)),t>this.nextRenderType&&(this.nextRenderType=t)}listenForRender(t,e){this.renderListeners.push(new ae(t,e))}onAnimationFrame(){for(let t of this.renderListeners)t.type<=this.nextRenderType&&t.component.forceUpdate();this.nextRenderType=g.RenderType.None,this.interactor.afterRender()}}(n=>{(t=>{t[t.None=0]="None",t[t.Overlay=1]="Overlay",t[t.Viewport=2]="Viewport",t[t.App=3]="App"})(n.RenderType||(n.RenderType={}))})(g||(g={}));var u=g;class le extends i.exports.Component{constructor(t){super(t);this.props.ui.listenForRender(u.RenderType.Overlay,this)}render(){const t=this.props.ui;return i.exports.createElement("div",{className:"overlay-plane"},t.selection.renderOverlay(),t.interactor.render())}}class ce extends i.exports.Component{constructor(t){super(t)}componentDidMount(){this.props.ui.listenForRender(u.RenderType.Viewport,this)}render(){const{config:t,schema:e,ui:s}=this.props;return i.exports.createElement("div",{id:"viewport"},i.exports.createElement("div",{className:`canvas grid-${t.gridSize}`,onMouseDown:this.onMouseDown.bind(this),onMouseMove:this.onMouseMove.bind(this),onMouseUp:this.onMouseUp.bind(this),onDoubleClick:this.onDoubleClicked.bind(this)},i.exports.createElement("div",{className:"document-plane",key:`document-${e.id}`},i.exports.createElement(qt,{config:t,ui:s,schema:e})),i.exports.createElement(le,{key:`overlay-${e.id}`,config:t,ui:s})))}onMouseDown(t){this.props.ui.interactor.onCanvasMouseDown(t)}onMouseMove(t){this.props.ui.interactor.onCanvasMouseMove(t)}onMouseUp(t){this.props.ui.interactor.onCanvasMouseUp(t)}onDoubleClicked(t){this.props.ui.interactor.onCanvasDoubleClicked(t)}}class q extends v{constructor(t=null){super("schema",new he,t);this.entities={},this.associations={}}registerEntity(t){this.entities[t.id]=t}getEntity(t){return this.entities[t]}hasEntity(t){return!!this.entities[t]}addEntity(t){this.entities[t.id]=t}removeEntity(t){delete this.entities[t]}newEntity(t,e=null){return new Zt(this,t,e)}get allEntities(){return Object.entries(this.entities).map(t=>t[1])}filterEntities(t){return Object.entries(this.entities).filter(e=>t(e[1])).map(e=>e[1])}mapEntities(t){return Object.entries(this.entities).map(e=>t(e[1]))}entityAt(t){for(let e of this.allEntities)if(Nt(e,t))return e}registerAssociation(t){this.associations[t.id]=t}getAssociation(t){return this.associations[t]}addAssociation(t){this.associations[t.id]=t}removeAssociation(t){delete this.associations[t]}newAssociation(t,e=null){return new it(this,t,null)}buildAssociation(){return new Gt(this)}get allAssociations(){return Object.entries(this.associations).map(t=>t[1])}filterAssociations(t){return Object.entries(this.associations).filter(e=>t(e[1])).map(e=>e[1])}mapAssociations(t){return Object.entries(this.associations).map(e=>t(e[1]))}demo(t){const e=this.newEntity({name:"Foo",x:75,y:60,color:"blue"});e.newAttributeFromRaw("first name*"),e.newAttributeFromRaw("last name"),e.newAttributeFromRaw("created at : datetime"),e.newAttributeFromRaw("address"),e.snapPosition(t);const s=this.newEntity({name:"Bar",x:500,y:60,color:"cyan"});s.newAttributeFromRaw("time : datetime"),s.newAttributeFromRaw("number* : integer"),s.newAttributeFromRaw("description"),s.snapPosition(t);const r=this.newEntity({name:"Baz",x:75,y:400,color:"green"});r.newAttributeFromRaw("name*"),r.newAttributeFromRaw("width: integer"),r.newAttributeFromRaw("height: integer"),r.snapPosition(t),this.buildAssociation().add(e,"one").add(s,"many").build(),this.buildAssociation().add(e,"one").add(r,"many").build()}}class he{}function pe(n){return n.filter((t,e)=>n.indexOf(t)===e)}class U extends i.exports.Component{constructor(t){super(t);this.selection=t.ui.selection}render(){let t=null;return this.selection.numEntites()?t=i.exports.createElement(ue,p({},this.props)):this.selection.numAssociations()&&(t=i.exports.createElement(me,p({},this.props))),i.exports.createElement("div",{id:"selection-menu",className:t?"show":""},t)}}class ue extends U{constructor(t){super(t);this.state={showColorMenu:!1}}colorsToStripes(t){const s=(this.props.config.gridSize*2-4)/t.length,r=[];let o=0;for(let a of t){const l=this.props.config.color(a);r.push(`${l} ${o}px`),o+=s,r.push(`${l} ${o}px`)}return`repeating-linear-gradient(45deg, ${r.join(", ")})`}render(){var r;const t=this.props.config,e=pe(this.selection.mapEntities(o=>o.state.color)).sort();let s={background:`${t.color(e[0])}`};return e.length>1&&(s.background=this.colorsToStripes(e)),i.exports.createElement("div",{className:"content"},i.exports.createElement("a",{className:"action color"},i.exports.createElement("div",{className:"color-circle",style:s,onClick:this.toggleColorMenu.bind(this)})),i.exports.createElement("a",{className:"action alert",title:"Delete Entity(s)",onClick:this.delete.bind(this)},i.exports.createElement(d.Delete,null)),((r=this.state)==null?void 0:r.showColorMenu)&&i.exports.createElement(de,{config:this.props.config,onSelect:o=>this.changeColor(o)}))}toggleColorMenu(){var t;this.setState({showColorMenu:!((t=this.state)!=null&&t.showColorMenu)})}changeColor(t){this.setState({showColorMenu:!1});const e=this.selection.allEntities;let s=!1;for(let o of e)if(o.state.color!=t){s=!0;break}if(!s)return;const r=e.map(o=>{const a=E(p({},o.state),{color:t});return new T(o,o.state,a)});this.selection.ui.history.pushActions(r)}delete(){this.selection.deleteEntities()}}class de extends i.exports.Component{render(){const t=this.props.config,e=Object.entries(t.colors).map(s=>{const r={background:s[1]};return i.exports.createElement("a",{className:"action color",key:s[0],onClick:()=>this.props.onSelect(s[0])},i.exports.createElement("div",{className:"color-circle",style:r}))});return i.exports.createElement("div",{className:"color-menu"},e)}}class me extends U{render(){const t=this.selection.allAssociations[0],e=t.sides,s=t.entities,r=e[0].arity=="many"?s[1].state.name:s[0].state.name,o=e[0].arity=="many"?s[0].state.name:s[1].state.name;return i.exports.createElement("div",{className:"content"},i.exports.createElement("div",{className:"one-name"},r),i.exports.createElement("div",{className:"arity"},"Has Many"),i.exports.createElement("div",{className:"many-name"},o),i.exports.createElement("a",{className:"action swap",title:"Swap Sides",onClick:()=>this.swapSides(t)},i.exports.createElement(d.SwapVertical,null)),i.exports.createElement("a",{className:"action alert",title:"Delete Association",onClick:this.delete.bind(this)},i.exports.createElement(d.Delete,null)))}swapSides(t){const e=t.sides,s=E(p({},e[0]),{arity:H(e[0].arity)}),r=E(p({},e[1]),{arity:H(e[1].arity)}),o=new L(s,r),a=new Jt(t,t.state,o);this.selection.ui.history.pushAction(a)}delete(){this.selection.deleteAssociations()}}class K{constructor(t){this.schema=t}dump(t){const e=t.cloneNode(!0);console.log("view node",e);const s=Rt(this.schema.allEntities.map(o=>({x:o.left,y:o.top})));let r=Mt(this.schema.allEntities.map(o=>({x:o.right,y:o.bottom})));return console.log(`document goes from ${s.x},${s.y} to ${r.x},${r.y}`),r=Q(r,s),e.setAttribute("width",`${r.x}px`),e.setAttribute("height",`${r.y}px`),e.setAttribute("viewport",`0 0 ${r.x} ${r.y}`),e.querySelectorAll("g.icon-container").forEach(o=>{o.remove()}),e.outerHTML}download(t){}}class xe{constructor(t){this.config=t}warn(t){console.log(`WARN [Reader]: ${t}`)}read(t,e){const s=document.createElement("html");s.innerHTML=t;const r=e.length?e:null,o=new q(r);return s.querySelectorAll("g.entity").forEach(a=>{this.parseEntity(o,a)}),s.querySelectorAll("g.association").forEach(a=>{this.parseAssociation(o,a)}),s.remove(),o}parseEntity(t,e){var m,x;const s=e.id,r=e.querySelector("rect.entity-name-bar");let o={x:0,y:0};r&&(o.x=parseInt(r.getAttribute("x")||"0"),o.y=parseInt(r.getAttribute("y")||"0"));let a="";const l=e.querySelector("text.entity-name");l!=null&&l.textContent&&(a=l.textContent);let c="blue";if((x=(m=e.dataset)==null?void 0:m.color)!=null&&x.length)try{c=e.dataset.color}catch{this.warn(`invalid color name ${e.dataset.color}`)}const h=t.newEntity({name:a,x:o.x,y:o.y,color:c},s);e.querySelectorAll("g.attribute").forEach(k=>{this.parseAttribute(h,k)})}parseAttribute(t,e){const s=e.id;let r="";const o=e.querySelector("text.attribute-name");o!=null&&o.textContent&&(r=o.textContent);let a="";const l=e.querySelector("text.attribute-type");l!=null&&l.textContent&&(a=l.textContent);let c=(e==null?void 0:e.classList.contains("required"))||!1;t.newAttribute({name:r,type:a,isRequired:c},s)}parseAssociation(t,e){var l,c,h,m;const s=e.id,r={entityId:((l=e.dataset)==null?void 0:l.fromId)||"",arity:((c=e.dataset)==null?void 0:c.fromArity)||"one"};if(!t.hasEntity(r.entityId)){this.warn(`No entity ${r.entityId}`);return}const o={entityId:((h=e.dataset)==null?void 0:h.toId)||"",arity:((m=e.dataset)==null?void 0:m.toArity)||"one"};if(!t.hasEntity(o.entityId)){this.warn(`No entity ${o.entityId}`);return}const a=new L(r,o);t.newAssociation(a,s)}}const ye="1.0.0";var G="/DBoard/assets/demo.67f7d86e.png";const Y="manifest";class N{constructor(){this.items={};const t=localStorage.getItem(Y);if(t&&t.length)try{this.items=JSON.parse(t)}catch(e){console.log(`Error parsing raw manifest "${t}"`,e)}}addItem(t){const e=E(p({},t),{raw:void 0});this.items[t.id]?console.log("Replacing local manifest item",e):console.log("Adding local manifest item",e),this.items[t.id]=e}removeItem(t){delete this.items[t.id]}getItem(t){return this.items[t]}write(){localStorage.setItem(Y,JSON.stringify(this.items))}get itemsInOrder(){return Object.entries(this.items).map(t=>t[1]).sort((t,e)=>(e.updatedAt||0)-(t.updatedAt||0))}loadItem(t){const e=localStorage.getItem(t.id);if(e)try{return JSON.parse(e)}catch(s){console.log("error parsing raw localstorage item",s,e)}return null}}class st{constructor(t){this.meta=t}static existingById(t){const s=new N().getItem(t);if(s)switch(s.origin){case"localStorage":return new w(s);default:throw`Unknown origin '${s.origin}'`}else return new w("")}save(t){const e=new K(t),s=document.getElementById("document"),r=e.dump(s);this.saveRaw(t.id,r)}export(t){const e=new K(t),s=document.getElementById("document");e.dump(s)}exportRaw(t){const e=document.createElement("a"),s=new Blob([t],{type:"image/svg+xml"});e.href=URL.createObjectURL(s),e.download=this.nameWithExtension,e.click(),e.remove()}get fileName(){const t=this.meta.name.split("/");return t[t.length-1]}set fileName(t){this.meta.name=t}get nameWithExtension(){return this.fileName.indexOf(".svg")>0?this.fileName:this.fileName+".svg"}get nameWithoutExtension(){return this.fileName.replace(/\.svg/i,"")}async load(t){const e=await this.loadRaw();return console.log("raw: ",e),new xe(t).read(e,this.meta.id)}}class w extends st{constructor(t){t.id?super(t):super({id:"",name:t,origin:"localStorage",raw:void 0,updatedAt:0})}saveRaw(t,e){const s={id:t,name:this.nameWithoutExtension,raw:e,updatedAt:new Date().valueOf(),origin:"localStorage"};localStorage.setItem(t,JSON.stringify(s));const r=new N;r.addItem(s),r.write()}async loadRaw(){return new Promise((t,e)=>{if(this.meta.id.length){const s=new N().loadItem(this.meta);if(s&&s.raw){t(s.raw);return}}t("<svg></svg>")})}renderButton(){return i.exports.createElement("div",null,i.exports.createElement(d.BlankDocument,null),i.exports.createElement("h2",null,"Blank"),i.exports.createElement("p",null,"Create a new blank document"))}}class ge extends w{constructor(){super({id:"",raw:void 0,name:"",origin:"localStorage",updatedAt:0})}async loadRaw(){const t=document.createElement("input");return t.setAttribute("type","file"),t.setAttribute("accept",".svg"),new Promise((e,s)=>{t.addEventListener("change",()=>{const r=t.files;if(console.log(`selected ${r==null?void 0:r.length} files`),!r)alert("You must select an SVG file to upload!");else if(r.length==1){const o=r[0];this.meta.name=o.name,o.text().then(a=>{e(a)})}else alert("You must select only one SVG file to upload!");t.remove()},!1),t.click()})}renderButton(){return i.exports.createElement("div",null,i.exports.createElement(d.Upload,null),i.exports.createElement("h2",null,"Upload"),i.exports.createElement("p",null,"Upload an SVG file that was previously generated with DBoard"))}}class fe extends w{constructor(){super({id:"demo",raw:void 0,name:"demo",origin:"localStorage",updatedAt:0})}async loadRaw(){return new Promise((t,e)=>{t(G)})}async load(t){const e=new q;return e.demo(t),new Promise(s=>{s(e)})}renderButton(){return i.exports.createElement("div",null,i.exports.createElement("img",{src:G}),i.exports.createElement("h2",null,"Demo"),i.exports.createElement("p",null,"A demo document with existing entities and associations"))}}class we extends i.exports.Component{constructor(t){super(t);this.state={items:this.props.manifest.itemsInOrder}}dataUri(t){const e=t.replace(/\%09/g,"").replace(/\%0A/g,"");return`data:image/svg+xml;base64,${btoa(e)}`}render(){const t=this.state.items.map(e=>{const s=new Date(e.updatedAt||0),r=this.props.manifest.loadItem(e),o=r&&r.raw?this.dataUri(r.raw):"";return i.exports.createElement("a",{key:e.id,className:"item",onClick:()=>this.onItemClicked(e)},i.exports.createElement("div",{className:"name"},e.name),r&&r.raw&&i.exports.createElement("img",{className:"preview",src:o}),i.exports.createElement("div",{className:"updated-at"},s.toDateString()),i.exports.createElement("div",{className:"close",onClick:a=>{this.onRemoveItem(e),a.stopPropagation()}},i.exports.createElement(d.Close,null)))});return i.exports.createElement("div",{className:"manifest"},t)}onItemClicked(t){this.props.onSourceSelected(new w(t))}onRemoveItem(t){const e=this.props.manifest;confirm("Remove this document from the recent list?")&&(e.removeItem(t),e.write(),this.setState({items:e.itemsInOrder}))}}class Ee extends i.exports.Component{constructor(t){super(t);this.sources=[new w("untitled"),new ge,new fe]}render(){const t=this.props.onPicked,e=this.sources.map((s,r)=>i.exports.createElement("a",{className:"source",key:`source-${r}`,onClick:()=>t(s)},s.renderButton()));return i.exports.createElement("div",{className:"source-picker-bg"},i.exports.createElement("div",{className:"source-picker"},i.exports.createElement("div",{className:"banner"},i.exports.createElement(J,null),i.exports.createElement("div",{className:"tagline"},"Open Source Data Modeler"),i.exports.createElement("div",{className:"version"},"Version ",ye)),i.exports.createElement("a",{className:"close",onClick:()=>this.props.onCanceled()},i.exports.createElement(d.Close,null)),i.exports.createElement("div",{className:"sources"},e),i.exports.createElement(we,{manifest:new N,onSourceSelected:s=>t(s)}),i.exports.createElement("div",{className:"footer"},i.exports.createElement("div",{className:"column"},i.exports.createElement("a",{href:"https://github.com/Terrier-Tech/DBoard",target:"_blank"},i.exports.createElement(d.Github,null),i.exports.createElement("span",null,"Source Code"))),i.exports.createElement("div",{className:"column"},i.exports.createElement("a",{href:"http://terrier.tech",target:"_blank"},i.exports.createElement(d.Terrier,null),i.exports.createElement("span",null,"\xA9 ",new Date().getFullYear()," Terrier Technologies"))))))}}class Ce extends i.exports.Component{constructor(t){super(t);this.config=new pt;const e=new q,s=new u(this.config,e);s.listenForRender(u.RenderType.App,this);const r=location.hash;let o=new w("untitled");if(console.log(`hash: ${r}`),r.length>1){const a=r.substring(1);o=st.existingById(a),this.reload(o)}this.state={ui:s,schema:e,source:o,pickSource:!0}}async reload(t){const e=await t.load(this.config),s=new u(this.config,e);s.listenForRender(u.RenderType.App,this),history.pushState(null,"",`#${e.id}`),this.setState({ui:s,schema:e,source:t,pickSource:!1})}open(){this.setState({pickSource:!0})}render(){const{schema:t,ui:e,source:s,pickSource:r}=this.state,o=r?"with-modal":"";return i.exports.createElement("div",{id:`app-${t.id}`,className:o},i.exports.createElement(ce,{key:`viewport-${t.id}`,config:this.config,ui:e,schema:t}),i.exports.createElement(St,{key:`topbar-${t.id}`,config:this.config,ui:e,schema:t,source:s,onOpen:this.open.bind(this)}),i.exports.createElement(U,{key:`menu-${t.id}`,config:this.config,ui:e,schema:t}),r&&i.exports.createElement(Ee,{onPicked:a=>this.reload(a),onCanceled:()=>this.setState({pickSource:!1})}))}}var be=document.getElementById("app");ct.exports.render(i.exports.createElement(Ce,null),be);
